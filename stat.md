
# 生物統計演習 第1回
## はじめに
### 目的
私たちは社会生活における様々な場面において、物事を比較、あるいは関連性を知りたい場面にしばしば遭遇するが、
なんらかの観察やデータに基づく「認知」によって、次の判断や行動指針を得る。統計学は数学的な確率分布に基づいて、
主観的な「勘」やこれまでの「信念」をできるだけ排除し、客観的な判断の指標を与えてくれる。ビッグデータや人工知能の
時代が到来し、統計学の重要性はこれまで以上に高まるだろう。


農学研究においても処理や条件の効果を統計学的手法により、できるだけ客観的に判断することが好ましい。
圃場Aと圃場Bでイネを栽培したとする。圃場Aで育てたイネのほうが収量が高かった。その主要因は何だろう。
圃場Aの土壌窒素量が高かったのかもしれないし、圃場Aで栽培した品種が高収量品種だったのかもしれない。
はたまた、ただの偶然でそのようなデータが得られた可能性もある。そのような違いや関連性を
統計学的な理論に基づいて分析し、各要因の効果の有無や大きさを推定することで、正しい結論に到達することが
できる。統計学的な手法を理解していないと、苦労して得た実験データが統計解析の条件を満たしておらず、
データが無駄になってしまった、ということも起こりうる。本演習では、演習を通して統計解析を経験し、
どのようなケースでどのような統計手法を用いることが適切なのか、その判断の素地となる考え方を習得する。

### 統計ソフトの利用
本演習では、統計解析ソフトRあるいはRStudioを用いて、演習問題を解きながら進める。
RStudioはRをインストールした後、インストールする。以降はRと称する。授業が開始する前にインストールしておくこと。
Rはwindows版、Mac版の両方が利用可能である。演習中にダウンロードする必要など出てくるため、
授業中は無線LAN(WiFi) (EdunetやKITE)に接続できるようにしておくこと。

### Rでの四則計算
四則演算は下記のように行う。#記号はコメントアウトとよび、#以降のコマンドは実行されない。
そのため\#以降にユーザーは説明文などを入れることができる。プログラムは他の人がみてもわかりやすいように
記述するべき、という考え方がある。一か月たつと自分でさえ分からなくなる場合があるので、\#を使ってわかり
やすく記述しよう。

和の演算子は+
```
1+2
[1] 3  # 答えは3
```
差の演算子は-
```
3 - 5 
[1] -2  # 答えは-2
```
積の演算子は* (アスタリスク)
8* (-1)
[1] -8  # 答えは-8

商の演算子は/ (スラッシュ)
```
-9 / 6
[1] -1.5  # 答えは-1.5
```
あまりの演算子は% (パーセント)。ただし%%と二回打つこと。最初の%と次の%の意味が異なるが今回は説明しない
```
5 %% 3
[1] 2  # 答えは2
```
べき乗の演算子は^ (ハット)
```
2 ^ 5
[1] 32  # 答えは32
```
平方根はsqrt()関数
```
sqrt(2)
[1] 1.414214  
```
### 変数
Rは電卓ではないので、通常、計算は変数に代入して処理する。変数に代入する演算子は <- あるいは =である。
変数名はアルファベットと数字の組み合わせで、ユーザーが自由に作れる。ただし、Rの中では使ってはいけない変数名があるので、
注意する。

変数appleに120を代入
```
apple <- 120   # 特に反応はない
apple = 120   # イコールのほうがタイプ数が少ない。<- と =はともに代入という意味。
apple  # 変数appleに何が入っているか確認する。
[1] 120 # appleには120が入っている。
```

変数kosuuに5を代入
```
kosuu = 5   # 特に反応はない
kosuu  # 変数kosuuに何が入っているか確認する。
[1] 5 # kosuuには5が入っている。
```

変数apple * kosuuを計算し、計算結果をdaikinに代入する。
```
daikin = apple * kosuu  # 特に反応はない
daikin  # 変数daikinに何が入っているか確認する。
[1] 600  # 120 * 5 = 600 の解が得られた。
```

### ベクトル
ベクトルを作成する場合はc()関数を用いる。ベクトルの演算は以下のように行う。

ベクトルの作成
```
a = c(7, 7, -5, 2, 8, 0, 7, -8, -1)  # 要素数9のベクトル
b = c(-4 ,7, 0, 6, 2, -6, -4, 3, 3)  # 要素数9のベクトル
```
ベクトルの和
```
c = a + b
c  # ベクトルcを確認
[1]  3 14 -5  8 10 -6  3 -5  2  # 結果
```
ベクトルの要素を二乗し、ベクトルdに代入
```
d = c^2
d  # ベクトルdを確認
[1] 49 49 25  4 64  0 49 64  1  # 結果
```
ベクトルの内積  内積の演算子は%*%
```
e = a %*% b
# eの表示 
     [,1]
[1,]   -6
```
a*bあるいはa/bとすると、Rではベクトルの各要素同士で積と商を計算するので注意すること。
```
a * b
[1] -28  49   0  12  16   0 -28 -24  -3

a / b
[1] -1.7500000 1.0000000 -Inf 0.3333333 4.0000000 0.0000000 -1.7500000
[8] -2.6666667 -0.3333333
```

### Rでの行列操作
線形代数の教科書では、$\vec{a}$、$\vec{b}$などのベクトルは小文字の太字$\boldsymbol{a}$、$\boldsymbol{b}$で示し、行列は
大文字の太字$\boldsymbol{A}$、$\boldsymbol{B}$にて示す。1行$m$列の行列を行ベクトルあるいは横ベクトルとよぶ。
$$\boldsymbol{a}=\begin{bmatrix} a_1 & a_2 & a_3 & a_4 & \cdots & a_m \end{bmatrix}$$
$n$行1列の行列を列ベクトルあるいは縦ベクトルとよぶ。

$$ \boldsymbol{b} = \begin{bmatrix}
b_1 \\
b_2 \\
\vdots \\
b_n
\end{bmatrix}
$$

行列の行と列を入れ替えたものを転置ベクトルと呼び、右上にTを付す。(教科書によってはプライムを付ける)。

$$\boldsymbol{b}^{T}=\begin{bmatrix} b_1 & b_2 & \cdots & b_n \end{bmatrix}$$

Rではベクトルを作成した段階では列ベクトルと行ベクトルの区別はないが、同じ長さのベクトルを行ベクトルとして
縦に結合する場合はrbind()関数で結合すると行列を作成できる。
```
a = c(7, 7, -5, 2, 8, 0, 7, -8, -1)  # 要素数9のベクトル
b = c(-4 ,7, 0, 6, 2, -6, -4, 3, 3)  # 要素数9のベクトル
X = rbind(a, b) 
X   # Xを表示
  [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9]
a    7    7   -5    2    8    0    7   -8   -1
b   -4    7    0    6    2   -6   -4    3    3
```
列ベクトルとして横に結合する場合はcbind()関数を用いる。
```
a = c(7, 7, -5, 2, 8, 0, 7, -8, -1)  # 要素数9のベクトル
b = c(-4 ,7, 0, 6, 2, -6, -4, 3, 3)  # 要素数9のベクトル
Y = cbind(a, b)
Y # Yを表示
       a  b
 [1,]  7 -4
 [2,]  7  7
 [3,] -5  0
 [4,]  2  6
 [5,]  8  2
 [6,]  0 -6
 [7,]  7 -4
 [8,] -8  3
 [9,] -1  3
```
$\boldsymbol{X}$ は(2 
$\times$
9)の行列、$\boldsymbol{Y}$は(9 
$\times$
2)の行列である。
$\boldsymbol{X} \boldsymbol{Y}$ は(2 
$\times$
9)
$\times$
(9 
$\times$
2)=(2 
$\times$
2)の
行列となる。行列の積は演算子\%*\%にて得ることができる。

```
Z = X %*% Y   # XとYの行列の積の答えをZに代入
Z  # Zを表示
    a   b
a 305  -6
b  -6 175
```
逆行列はsolve()関数にてえる。
```
W = solve(Z)
W  # 計算結果の表示
            a           b
a 0.003280901 0.000112488
b 0.000112488 0.005718142
```
$\boldsymbol{Z}^{-1}$と$\boldsymbol{Z}$の積により、単位行列$\boldsymbol{I}$を得る。

$$
\boldsymbol{Z}^{-1}\boldsymbol{Z}=\boldsymbol{I} =
\begin{bmatrix}
1 & 0\\
0 & 1
\end{bmatrix}
$$

```
W %*% Z  # 計算結果の表示
  a             b
a 1 -3.469447e-18
b 0  1.000000e+00
```
数値計算なので誤差が出ているが、ほぼ$\boldsymbol{I}$。ちなみに-3.469447e-18は
$-3.469447 \times 10^{-18}$を表す。

Rにて計算を行う場合は、毎回計算結果を変数に代入することなく、複数の関数を組み合わせて使うことができる。例えば、上記の一連の流れを
```
solve(rbind(a, b) %*% cbind(a, b)) %*% (rbind(a, b) %*% cbind(a, b))
# 結果の表示
  a             b
a 1 -3.469447e-18
b 0  1.000000e+00
```
のように計算できる。

## データフレームの取り扱い
### Fisherのアヤメのデータ
統計解析行うデータは、表形式のテキストデータを読み込んで解析を行う。
ここではアヤメ(Iris)三種、*Iris setosa*、*Iris versicolor*、*Iris virginica* の種別の花弁およびがくに関する多変量データを紹介する
(Fisher RA. 1936. The use of multiple measurements intaxonomic problems. Annals of Eugenics 7:179-188)。

irisとタイプすると、表が**データフレーム**形式で読み込まれる。最初の数行をhead()関数で表示させる。

```
head(iris)
# 結果の表示
  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa
```
Sepal.Lengthは花弁の長さ、Sepal.Widthは花弁の幅、Petal.Lengthはがくの長さ、Petal.Widthはがくの幅、Speciesは種名をしめす。

### データフレームからのデータの抽出###
データフレームからデータを切り出すときの方法について説明する。
データの取り出し方には (1) ドルマークを使って列名を指定する方法と、(2)行と列の座標により指定する方法がある。

#### 列名による指定
データフレームの列名で指定する。irisとタイプした後にドルマークをタイプし、キーボード左上付近の「Tab」キーを打つと、候補が出てくるので
列名を選択する。タイプミスを避けるため積極的にtabキーは利用するべきである。Rのデフォルトの関数もtabキーで予測できる。
ただし、ヒントで最初の何文字かは与えよう。ユーザーが今何をしたいかまでは、予測してくれません。

```
#irisデータフレームのSepal.Length列にアクセス
iris$Sepal.Length  
```

#### 行と列の座標による指定
データフレーム名irisのa行b列のデータを取り出す。
```
iris[a,b]
```
「データフレーム名irisのb列のデータをすべて取り出す。
```
iris[,b]
```
「データフレーム名irisの''Species''列のデータをすべて取り出す。
```
iris[,"Species"]
```
「データフレーム名irisのb1からb2列のデータをすべて取り出す。
```
iris[,b1:b2]
```
「データフレーム名irisのa行のデータをすべて取り出す。
```
iris[a,]
```

#### 条件抽出
データフレーム名irisのSpecies列が"setosa"であるSepal.Length列を取り出す
```
ris[iris$Species=="setosa","Sepal.Length"]
```

### 演習問題
データフレームirisに対して、

問題1 setosaの花弁長(Sepal.Length)をSL\_setosaに代入せよ。

問題2 versicolorの花弁長(Sepal.Length)をSL\_versicolorに代入せよ。

問題3 virginicaの花弁長(Sepal.Length)をSL\_virginicaに代入せよ。

### 演習問題の答え
```
SL_setosa = iris[iris$Species=="setosa","Sepal.Length"]
SL_versicolor = iris[iris$Species=="versicolor","Sepal.Length"]
SL_virginica = iris[iris$Species=="virginica","Sepal.Length"]
```
