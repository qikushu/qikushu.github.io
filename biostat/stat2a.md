# 生物統計演習 第2回 推定
## 推定について

実験や観察によって得られたデータは、サンプル数が十分大きい**母集団 (population)** から得られた**標本(sample)** であるとし、
標本から母集団全体を推定する方法を **推定統計(inferential statistics)** という。

母平均と標本平均を $\mu$ および $m$ 、
母分散と標本の分散を $\sigma^2$ および $s^2$ とおく。
経験的に $\mu$ と $m$ は似ているし、
$\sigma^2$ と $s^2$ も似ているだろうが、どのように似ているかはわからない。通常、標本から母数をよりよく推定する。

<img src="./Yv2RteVWRz.png" width="500" style="background-color:white;">

**標本から母集団の母数の推定**

## 期待値と分散
#### 離散変数の期待値
$X$が確率変数の場合、その期待値を$\textrm{E}[X]$とおく。$X$が離散分布する変数の場合、$X=X_i$になるときの確率を$p_i$とすると

$$ \textrm{E}[X] = \sum_{i=1}^{n} p_i X_i $$

と表す。
離散分布する変数の例としてはサイコロや宝くじがある。サイコロを1回投げた場合の期待値は、$\frac{1}{6} \cdot 1 +\frac{1}{6} \cdot 2 +\frac{1}{6} \cdot 3 +\frac{1}{6} \cdot 4 +\frac{1}{6} \cdot 5 +\frac{1}{6} \cdot 6 = \frac{1+2+3+4+5+6}{6}=3.5$である。また、平成28年11~12月に行われた年末ジャンボ宝くじの発売数と当選数、当選金額は以下のとおりである。

**宝くじ当せん金・本数(発行枚数が5億枚の場合**

|等級等 | 当せん金 | 本数 |
----| ----|----
|1等 | 700,000,000円 | 25本 |
|1等の前後賞 | 150,000,000円 | 50本 |
|1等の組違い賞 | 500,000円	 & 4,975本 |
|2等 | 15,000,000円 | 500本 |
|3等 | 1,000,000円 | 5,000本 |
|4等 | 10,000円 | 500,000本 |
|5等 | 3,000円 | 5,000,000本 |
|6等 | 300円 | 50,000,000本 |

この場合、期待値は149.975円となる。

#### 連続変数の期待値
$x$が連続分布する変数の場合、$x$の確率密度関数を$f(x)$とすると、

$$ \textrm{E}[x] = \int_{-\infty}^{\infty} xf(x) dx $$

と表す。$x$と$x$が起こる確率$P(x)$の積の総和が期待値であることには変わりはない。
離散変数の期待値と比較すると、総和の記号$\Sigma$が
積分記号$\int$に、$f(x) \mathrm{d}x$は$x$の時の確率$P(x)$に対応している。

### 母集団
### 母平均と母分散の定義
離散変数および連続変数$X$についての期待値を、母平均$\textrm{E}[X] = \mu_X$と定義する。
$X$についての分散$\textrm{V}[X] = \textrm{E}[(X-\textrm{E}[X])^2]$を
母分散$\textrm{V}[X] = \sigma_X^2$と定義する。

### 1変数の平均と分散
正規分布を例に、期待値と分散の性質を理解する。様々な事象が持つばらつきや誤差の多くは正規分布に従うことが知られている。以下の演習にて
目で見てみよう。

```
# 平均10、標準偏差2の正規分布をもつ母集団から、10個の標本をランダムに取り出す
rnorm(n=10, mean=10, sd=2)
# 結果が見えたか。10回シミュレーションしなさい。毎回結果はどうなるか。

# 次は散布図にて観察する。 n=100
stripchart(rnorm(n=100, mean=10, sd=2), method="jitter", pch=".")
# n=5000 にして標本数を大きくする
stripchart(rnorm(n=5000, mean=10, sd=2), method="jitter", pch=".")
# 10回シミュレーションしなさい。 平均値はどのあたりを推移するか。

# 散布図では数がわからないので、ヒストグラムを作成する。
# nclassオプションは最大値と最小値の間をnclassの数で均等に分割して、区間を自動的に設定してくれる
便利な機能である。分布の概略をつかみたいだけの場合は便利である
hist(rnorm(n=5000, mean=10, sd=2), nclass=100)
# 10回シミュレーションしなさい。ランダムにサンプリングされているが、個体数が多いと母集団の概略が見えてくるだろう

# sdを大きくしたり、小さくしたりして、ヒストグラムを眺めてみてください。横軸の単位を注意深く見ましょう
# 5回いじってみてください。
hist(rnorm(n=5000, mean=10, sd=1), nclass=100)
hist(rnorm(n=5000, mean=10, sd=3), nclass=100)
hist(rnorm(n=5000, mean=10, sd=10), nclass=100)

# 平均値の計算をしなさい。10回シミュレーションしなさい。平均値がばらつくのはなぜですか？
mean(rnorm(n=5000, mean=10, sd=2))
# 標準偏差を100に変更して、平均値の計算をしなさい。10回シミュレーションしなさい。標準偏差2のときにくらべてなにか気が付きますか。
mean(rnorm(n=5000, mean=10, sd=100))

# 不偏分散を計算しなさい。10回シミュレーションしなさい。(ヒント: 標準偏差の二乗が分散です)
var(rnorm(n=5000, mean=10, sd=2))
# 標準偏差を100に変更して、不偏分散の計算をしなさい。10回シミュレーションしなさい。標準偏差2のときにくらべてなにか気が付きますか。
var(rnorm(n=5000, mean=10, sd=100))
```

### 2変数の平均と分散
確率変数$X$と$Y$の2変数を足したり引いたりしたときの平均と分散はどのように変化するだろうか。以下が公式である。

#### 期待値の公式
確率変数$X$についての期待値は

$$\textrm{E}(X) = \mu_X $$

であり、母平均$\mu_X$の定義である。$a$が定数のとき、

$$ \textrm{E} [a] = a \quad \mbox{(定数の期待値は定数)} $$

$$ \textrm{E} [X + a] = \textrm{E}[X] + a  \quad \mbox{(定数は外に出せる1)} $$

$$ \textrm{E} [aX] = a\textrm{E}[X] \quad \mbox{(定数は外に出せる2)} $$

$$ \textrm{E} [X+Y] = \textrm{E}[X]+\textrm{E}[Y]  \quad \mbox{(期待値の和は、和の期待値と等しい)} $$

$$ \textrm{E} [XY] = \textrm{E}[X]\textrm{E}[Y] \quad (ただし、XとYが独立の場合) $$

が成り立つ。

#### 分散の公式
確率変数$X$についての分散の定義は、

$$\textrm{V}[X] = \textrm{E}[(X-\textrm{E}[X])^2] = \sigma_X^2 $$
である。$a$が定数とすると

$$  \textrm{V}[a] = 0 \quad \mbox{(定数の分散は0)} $$

$$ \textrm{V}[aX] = a^2 \textrm{V}[X] \quad \mbox{($X$の$a$倍の分散は、$X$の分散の$a^2$倍)} $$

$$ \textrm{V}[X + a] = \textrm{V}[X] \mbox{(定数の和は無視)} $$

である。

```
# 平均10、標準偏差2の正規分布に従うXを5000個ランダムサンプリング
X=rnorm(n=5000, mean=10, sd=2)
# 平均23、標準偏差5の正規分布に従うYを5000個ランダムサンプリング
Y=rnorm(n=5000, mean=23, sd=5)
# 散布図を書きなさい。平均はどのあたりですか
stripchart(X+Y, method="jitter", pch=".")
# ヒストグラムを書きなさい、平均はどのあたりですか
hist(X+Y, nclass=100)
# 平均を計算しなさい
mean(X+Y)
# 不偏分散を計算しなさい。得られた不偏分散は理論値と比べていかがですか。(ヒント var(X)+var(Y) = sd(X)^2 + sd(Y)^2)
var(X+Y)
```

#### 共分散
確率変数$X$と$Y$について$\textrm{V}[X]  = \sigma_X^2$および
$\textrm{V}[Y]  = \sigma_Y^2$のとき、

$$ \textrm{V}[X \pm Y] = \textrm{V}[X] + \textrm{V}[Y] \pm 2 \cdot \textrm{Cov}[X,Y] $$

である。ただし、$\textrm{Cov}[X,Y]$は**共分散(co-variance)** といい、

$$ \textrm{Cov}[X,Y] = \textrm{E}[ ( X - \textrm{E}(X) )( Y - \textrm{E}(Y))] = r \cdot  \sigma_X \cdot \sigma_Y $$

の性質を持つ。$r$は **相関係数**といい、 $-1 \leq r \leq  1$の範囲を持つ。$X$と$Y$が独立の場合は $r=0$となり、$\textrm{Cov}[X,Y]=0$であるため、

$$ \textrm{V}[X \pm Y] = \textrm{V}[X] + \textrm{V}[Y] $$

となる。すなわち、分散は$X$と$Y$が独立ならば、$X+Y$の分散は、$X$の分散と$Y$の分散に分割できる。

#### 練習問題
1. コムギの10アール(a)当たり収量について、品種Aの収量をしめす確率変数$A$は母平均386.1 kg/10aおよび母標準偏差25.4 kg/10aをもつ。コムギの20アールにおける母平均と母標準偏差はいくつが期待されるか。
1. コムギ品種Bの確率変数$B$は母平均333.6 kg/10aおよび母標準偏差は22.4 kg/10aをもつと仮定する。品種Aを10 a、品種Bを10 a育成した場合、両者を合わせたコムギ収量の母平均と母標準偏差はいくつか。ただし、品種Aと品種Bの育成は相互に影響を与えない(独立)とする。
1. 品種Aを10 a、品種Bを20 a育成した場合、両者を合わせたコムギ収量の母平均と母標準偏差はいくつか。ただし、品種Aと品種Bの育成は相互に影響を与えない(独立)とする。

#### 練習問題こたえ
1. $\textrm{E}[2A] = 2\textrm{E}[A] = 2 \cdot 386.1 = 772.2$、$\textrm{V}[2A] = 2^2 \cdot \textrm{V}[A] = 4 \cdot 25.4^2 = 2580.64$。ゆえに母平均は772.2、母標準偏差は$\sqrt{2580.64}=50.8$である。
1. $\textrm{E}[A+B] = \textrm{E}[A]+\textrm{E}[B]=386.1+333.6 = 719.7$ kg/10aである。また、$\textrm{V}[A+B]=\textrm{V}[A] + \textrm{V}[B] = 25.4^2 + 22.4^2 =1146.92$より、母標準偏差は$\sqrt{1146.92}\fallingdotseq33.87$である。
1. $\textrm{E}[A+2B] = \textrm{E}[A]+\textrm{E}[2B]=386.1+2 \cdot 333.6 = 1053.3$ kg/10aである。また、$V[A+2B]=\textrm{V}[A] + \textrm{V}[2B] = 25.4^2 + 4 \cdot 22.4^2 =2652.2$より、母標準偏差は$\sqrt{2652.2}\fallingdotseq51.50$である。

Rでシミュレーションして確かめてみると、理解が深まる。

### 標本集団
#### 標本から母平均を推定

母集団から得た標本$X$の期待値は母平均と等しい。
$$ \textrm{E}[X] = \mu $$

標本の平均$\bar X = (X_1 + X_2 + \cdots + X_n) / n $は母平均と一致しない。
しかし、標本数を大きく取ると、標本平均$\bar{X}$は$\mu$に近づく。これを**大数の法則**という。
以上より、母平均$\mu$の推定値として、
標本平均$\bar{X}$を用いてよい。

#### 標本から母分散を推定
標本の不偏分散 $ s^2 = ((X_1 - \bar X)^2 + \cdots + (X_n - \bar X)^2)/(n-1) $の期待値は、母分散$\sigma^2$と等しい。

$$E[s^2]  = \sigma^2 $$
すなわち、母分散 $\sigma^2$ の推定値として、
$s^2$を用いる。**

#### 標本平均の分散の推定
中心極限定理から、標本平均の分散の期待値$\textrm{V}[\bar X]$は、標本の不偏分散$s^2$を個体数$n$で割った値と等しい。。

$$ \textrm{V}[\bar X] = \frac{s^2}{n} $$

すなわち、標本$X$の平均$\bar{X}$をとると、分散は$n$分の1になることを示し、多くのサンプルからの平均を取った方が母平均の推定値として安定する。
この平方根$s/\sqrt{n}$を**標準誤差 (Standard error)** といい、標本の平均値の標準偏差である。


### 練習問題
コムギ品種Aの10アール(a)当たり収量について、5箇所の調査を行い、$280, 290, 300, 260, 255$ kg/10aのデータを得た。
1. コムギ品種Aの母平均、母分散、母標準偏差を推定せよ。
1. 標本平均の標準誤差を求めよ。

### 練習問題こたえ
1. 標本平均はmean()関数、不偏分散はvar()関数にて求める。
```
a = c(280, 290, 300, 260, 255)
mean(a)
[1] 277
var(a)
[1] 370
# よって、標本平均は277, 不偏分散は370
```
2. 母平均の不偏推定値は標本平均である。母分散の不偏推定量は不偏分散である。母分散の平方根は母標準偏差(定義)である。
```
sqrt(var(a))
[1] 19.23538
# よって、母平均の不偏推定値は277、母分散の不偏推定量は370、母標準偏差の不偏推定値は370の平方根の19.23538である。
```
3. 標本平均の標準誤差は、不偏分散を標本数で割った平方根。
```
sqrt(var(a)/5)
[1] 8.602325
# よって、標本平均の標準誤差は8.602325である。
```
