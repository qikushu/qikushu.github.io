<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <meta name="author" content="Yoshiyuki Yamagata" />
  <title>2023生物統計学第6回</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">2023生物統計学第6回</span>
        <ul class="nav pull-right doc-info">
                    <li><p class="navbar-text">Yoshiyuki
Yamagata</p></li>
                              <li><p class="navbar-text">2023年11月13日</p></li>
                  </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div class="span12">

      
      <h1 id="生物統計演習-第6回-相関と回帰">生物統計演習 第6回
相関と回帰</h1>
<h2 id="二次元のデータ">二次元のデータ</h2>
<p><span class="math inline">\(2\)</span>個の変数、例えば<span
class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>を<span
class="math inline">\(n\)</span>組観測して得られた場合、これを2次元データという。単純に<span
class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>が独立か、関係があるかを調べる場合を
<strong>相関</strong> という。一方、<span
class="math inline">\(x\)</span>に依存して<span
class="math inline">\(y\)</span>が変化する(あるいは<span
class="math inline">\(y\)</span>に依存して<span
class="math inline">\(x\)</span>が変化する)と考えて<span
class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>の関連を調査する場合を<strong>回帰</strong>という。回帰は観測値<span
class="math inline">\(y\)</span>から回帰直線までの距離を最小化するように、回帰直線を推測する。距離を最小化する方法としては回帰直線に垂線をおろしてその距離を最小化する方法も考えられる。それは直交回帰
(主成分分析)とよび、本授業では扱わない。</p>
<table>
<thead>
<tr class="header">
<th><img src="yZopjbmP.png" alt="" width="60%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>二次元データの散布図と関連を解析する手法の考え方の違い</strong></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th><img src="yZopjbmP.png" alt="" width="60%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>二次元データの散布図と関連を解析する手法の考え方の違い</strong></td>
</tr>
</tbody>
</table>
<p><img src="yZopjbmP.png" alt="" width="60%"></p>
<h3 id="相関">相関</h3>
<p>表はマグロ漁船員の頭髪中の総水銀量と経験年数との関係を示している。</p>
<p><strong>マグロ　漁船員の頭髪中の総水銀量と経験年数との関係(滝沢1972一部改変)</strong></p>
<table style="width:100%;">
<colgroup>
<col style="width: 15%" />
<col style="width: 7%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="header">
<th>経験年数</th>
<th>9</th>
<th>9</th>
<th>10</th>
<th>13</th>
<th>15</th>
<th>18</th>
<th>19</th>
<th>20</th>
<th>25</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>総水銀量</td>
<td>43.7</td>
<td>41.4</td>
<td>49.4</td>
<td>51.8</td>
<td>54.2</td>
<td>55.2</td>
<td>45.7</td>
<td>49.5</td>
<td>60.1</td>
</tr>
</tbody>
</table>
<p><code>scatter()</code>関数により、横軸(x軸)と縦軸(y軸)からなる平面に点が打たれた図であり、二つのデータの関連が一目で確認できる。データの系列は列方向に並んでおり、列名で識別できるデータが望ましい。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="va">url</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/qikushu/stat/master/mercury_cor.txt&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">d</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url</span>)<span class="op">;</span> <span class="co">% 読み込み</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="va">d</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">% plot</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="va">scatter</span>(<span class="va">d</span>.<span class="va">year</span><span class="op">,</span> <span class="va">d</span>.<span class="va">mercury</span>) </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="va">title</span>(<span class="ss">&#39;散布図&#39;</span>)<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">&#39;経験年数&#39;</span>)<span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">&#39;総水銀量&#39;</span>)<span class="op">;</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th><img src="Kz7YG6nQZd.png" alt="" width="30%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>散布図の一例</strong></td>
</tr>
</tbody>
</table>
<h4 id="ピアソンの相関係数-パラメトリック解析">ピアソンの相関係数
(パラメトリック解析)</h4>
<p>計量データの相関を測定する統計量として、
<strong>ピアソンの相関係数</strong> が知られ、しばしば<span
class="math inline">\(r\)</span>と表記する。ピアソンの相関係数<span
class="math inline">\(r\)</span>は、母集団が正規分布に従うことを仮定する。このような解析をパラメトリック分析という。</p>
<p><span class="math inline">\(x=\{x_1, x_2, x_3, \cdots,
x_n\}\)</span>、<span class="math inline">\(y=\{y_1, y_2, y_3, \cdots,
y_n\}\)</span>の相関係数<span class="math inline">\(r\)</span>は<span
class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>の共分散<span
class="math inline">\(s_{xy}^2= \frac{\sum^{n}_{i=1} (x_i - \bar{x})
(y_i - \bar{y})}{n-1}\)</span>、 <span
class="math inline">\(x\)</span>の標準偏差<span
class="math inline">\(s_x = \sqrt{ \frac {\sum^{n}_{i=1} (x_i -
\bar{x})^2}{n-1}}\)</span>、<span
class="math inline">\(y\)</span>の標準偏差<span
class="math inline">\(s_{y}= \sqrt{ \frac {\sum^{n}_{i=1} (y_i -
\bar{y})^2}{n-1}}\)</span>としたとき、 <span class="math display">\[
    r = \frac{s_{xy}^2}{s_x \cdot s_y} \\
\]</span> と計算する。<span class="math inline">\(-1 \leq r \leq
1\)</span>の範囲をとり、<span
class="math inline">\(r\)</span>が正の値をとるときは<span
class="math inline">\(x\)</span>が増えるほど<span
class="math inline">\(y\)</span>が増える傾向があり、<span
class="math inline">\(r\)</span>が負の値をとるときは<span
class="math inline">\(x\)</span>が増えるほど<span
class="math inline">\(y\)</span>が減少する傾向がある(図)。絶対値が大きいほどその傾向が顕著である。</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="va">year</span> <span class="op">=</span> <span class="va">d</span>.<span class="va">year</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">mercury</span> <span class="op">=</span> <span class="va">d</span>.<span class="va">mercury</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">% 共分散</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="va">s2xy</span> <span class="op">=</span> <span class="va">cov</span>(<span class="va">year</span><span class="op">,</span> <span class="va">mercury</span>)<span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">% s2xyは分散共分散行列といい、対角成分は自身の分散で、非対角成分が共分散である。</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 結果</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span><span class="va">xy</span> <span class="op">=</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>   <span class="fl">32.9444</span>   <span class="fl">23.9722</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>   <span class="fl">23.9722</span>   <span class="fl">35.3211</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>と標準偏差から求める</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span>(<span class="va">year</span><span class="op">,</span> <span class="va">mercury</span>) <span class="op">/</span> ( <span class="va">std</span>(<span class="va">year</span>) <span class="op">*</span> <span class="va">std</span>(<span class="va">mercury</span>)  )</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th><img src="plus_r_plot.png" alt="" width="30%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><span
class="math inline">\(r\)</span>が正の時の散布図</strong></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th><img src="minus_r_plot.png" alt="" width="30%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong><span
class="math inline">\(r\)</span>が負の時の散布図</strong></td>
</tr>
</tbody>
</table>
<h3 id="相関係数の意味">相関係数の意味</h3>
<p>いま<span
class="math inline">\(n\)</span>組の2次元データについて考えているが、見方を代えて<span
class="math inline">\(n\)</span>次元データが2つあると考えると、平面上に二つのベクトルが原点から伸びていると考えられる。<span
class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>から平均値を引いて作成した偏差ベクトルを<span
class="math inline">\(\vec{d_x}\)</span>および<span
class="math inline">\(\vec{d_y}\)</span>とする (図)。</p>
<table>
<thead>
<tr class="header">
<th><img src="ycAtbdVD.png" alt="" width="60%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>データをベクトルとして捉えるみかた</strong></td>
</tr>
</tbody>
</table>
<p>ここで余弦定理より、 <span class="math display">\[
    \vec{d_x} \cdot \vec{d_y} = |\vec{d_x}| |\vec{d_y}| cos \theta \\
    cos \theta = \frac{\vec{d_x}}{|\vec{d_x}|} \cdot
\frac{\vec{d_y}}{|\vec{d_y}|} = r
\]</span> ただし、<span
class="math inline">\(|\vec{d_x}|\)</span>および<span
class="math inline">\(|\vec{d_y}|\)</span>は<span
class="math inline">\(\vec{d_x}\)</span>と<span
class="math inline">\(\vec{d_y}\)</span>のベクトルの長さであり、なす角を<span
class="math inline">\(\theta\)</span>とする。<span
class="math inline">\(\vec{d_x}/|\vec{d_x}|\)</span>および<span
class="math inline">\(\vec{d_y}/|\vec{d_y}|\)</span>は標準化により長さが1のベクトルである。</p>
<p>右辺は相関係数<span
class="math inline">\(r\)</span>と等しいことが知られている(補足資料1)。相関係数は片方のベクトルからもう片方のベクトルに垂線を下した時のその余弦の長さである。ベクトルの長さを1に揃えてベクトルがどれくらい同じ方向を向いているのかを調べている。完全に同じなら+1、完全に逆方向なら-1、直交していれば無関係で0となる。</p>
<p>それではmatlabにて計算して見よう</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="va">year</span> <span class="op">=</span> <span class="va">d</span>.<span class="va">year</span><span class="op">;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">mercury</span> <span class="op">=</span> <span class="va">d</span>.<span class="va">mercury</span><span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="va">dy</span> <span class="op">=</span> <span class="va">year</span> <span class="op">-</span> <span class="va">mean</span>(<span class="va">year</span>)  <span class="co">% 平均値からの偏差ベクトルを作成</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="va">dm</span> <span class="op">=</span> <span class="va">mercury</span> <span class="op">-</span> <span class="va">mean</span>(<span class="va">mercury</span>)  <span class="co">% 平均値からの偏差ベクトルを作成</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="va">length_dy</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="va">sum</span>(<span class="va">dy</span><span class="op">.^</span><span class="fl">2</span>))  <span class="co">% 各要素の二乗和の平方根がベクトルの長さ</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="va">length_dm</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="va">sum</span>(<span class="va">dm</span><span class="op">.^</span><span class="fl">2</span>)) <span class="co">% 各要素の二乗和の平方根がベクトルの長さ</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">% 内積</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="va">dot</span>((<span class="va">dy</span> <span class="op">/</span> <span class="va">length_dy</span> ) <span class="op">,</span>(<span class="va">dm</span> <span class="op">/</span> <span class="va">length_dm</span> ))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">% ans =</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">%    0.7027</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">%標準関数</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="va">corr</span>(<span class="va">year</span><span class="op">,</span> <span class="va">mercury</span>)</span></code></pre></div>
<h4 id="無相関の検定">無相関の検定</h4>
<p>相関係数に関して有意性の検定を行うことができる。帰無仮説(<span
class="math inline">\(H_0\)</span>)は両者に相関はない、すなわち母相関係数<span
class="math inline">\(\rho=0\)</span>(<span
class="math inline">\(\rho\)</span>,
ローと読む)とする。観察より得られたピアソンの相関係数<span
class="math inline">\(r\)</span>について、</p>
<p><span class="math display">\[
    t = \frac{r \sqrt{n-2}}{\sqrt{1-r^2}}
\]</span> は自由度<span class="math inline">\(n-2\)</span>の<span
class="math inline">\(t\)</span>分布に従うことが知られている。ただし、<span
class="math inline">\(n\)</span>はデータ対の数である。式から<span
class="math inline">\(r\)</span>と<span
class="math inline">\(t\)</span>の正負が一致することがわかる。<span
class="math inline">\(p\)</span>は<span
class="math inline">\(t\)</span>分布において、<span
class="math inline">\(&gt;|t|\)</span>を満たす両側のすそ野を足し合わせて得る。有意水準<span
class="math inline">\(\alpha=0.05\)</span>に設定し、通常の<span
class="math inline">\(t\)</span>検定と同様に有意性を判定する。上記の例について検定をしてみよう。</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="fl">0.6974281</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="va">n</span><span class="op">=</span><span class="fl">9</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">t</span> <span class="op">=</span> <span class="va">r</span> <span class="op">*</span> <span class="va">sqrt</span>(<span class="va">n</span> <span class="op">-</span> <span class="fl">2</span>)<span class="op">/</span><span class="va">sqrt</span>(<span class="fl">1</span><span class="op">-</span><span class="va">r</span><span class="op">^</span><span class="fl">2</span>)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">% 結果の表示</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 自由度n-2における5%棄却域を求める</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="va">tCriticalValue</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">,</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">2</span>)<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">% 2.3646</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">% 得られたtは有意水準5%における両側確率の棄却域 -2.364624 &lt; t &lt; 2.364624に</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 含まれていない。そのため、帰無仮説を棄却し、対立仮説を採用する。</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">% 相関係数は0とは言えない。</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">% 直接p値を求める。</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">% 帰無仮説(rho = 0)のもと、t値が得られる確率を求める (両側なので二倍する)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>(<span class="fl">1</span> <span class="op">-</span> <span class="va">tcdf</span>(<span class="va">t</span><span class="op">,</span> <span class="va">n</span> <span class="op">-</span> <span class="fl">2</span>))<span class="op">*</span><span class="fl">2</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">% 0.0367514</span></span></code></pre></div>
<p>有意水準5%より小さいため、帰無仮説を棄却する。母相関係数は0とは言えない。</p>
<h4
id="matlabデフォルトの関数を用いた方法">matlabデフォルトの関数を用いた方法</h4>
<p><code>corrcoef</code>関数は<code>corr</code>よりパワフルで、行列を処理可能である。任意の2列の総当たりで相関係数が計算される。得られる行列を
<strong>相関行列</strong> という。</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">r</span><span class="op">,</span> <span class="va">p</span>] <span class="op">=</span> <span class="va">corrcoef</span>(<span class="va">year</span><span class="op">,</span> <span class="va">mercury</span>)<span class="op">;</span>  <span class="co">% rは相関係数、pはp値</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">r</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="va">p</span></span></code></pre></div>
<h4
id="三群以上のデータに関する相関行列">三群以上のデータに関する相関行列</h4>
<p>これまで2群のデータについて紹介した。データが3群以上ある多変量の場合についても
二つを一対とする相関関係を調べていく。総当たりで相関関係を調べ、相関係数を表の形のしたものを
<strong>相関係数行列</strong>
という。下記のデータは、世界各国における男女の寿命、喫煙、アルコール摂取、GDPをに関するデータである。データは統計教育推進委員会教育教材サイトより引用した(http://www.jfssa.jp/statedu/)。</p>
<p>まずは散布図を眺め、相関係数を計算しよう。</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データ読み込み</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">url3</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/qikushu/stat/master/lifetime.txt&quot;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">T3</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url3</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="va">head</span>(<span class="va">T3</span>)  <span class="co">% 読み込みの確認</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="va">ary3</span> <span class="op">=</span> <span class="va">table2array</span>(<span class="va">T3</span>)<span class="op">;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 散布図行列の作成</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>[<span class="op">~,</span><span class="va">ax</span>] <span class="op">=</span> <span class="va">plotmatrix</span>(<span class="va">ary3</span>)<span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co">% ラベルを付けるのは難しいようです。とにかく以下を実行してください</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 変数の数を取得</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="va">numVars</span> <span class="op">=</span> <span class="va">size</span>(<span class="va">ary3</span><span class="op">,</span> <span class="fl">2</span>)<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co">% 各サブプロットのx軸とy軸にラベルを設定</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="va">i</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">numVars</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="co">% y軸ラベル（左端の列）</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="va">ylabel</span>(<span class="va">ax</span>(<span class="va">i</span><span class="op">,</span> <span class="fl">1</span>)<span class="op">,</span> <span class="va">T3</span>.<span class="va">Properties</span>.<span class="va">VariableNames</span>{<span class="va">i</span>})<span class="op">;</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">% x軸ラベル（最下行の列）</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="va">xlabel</span>(<span class="va">ax</span>(<span class="va">numVars</span><span class="op">,</span> <span class="va">i</span>)<span class="op">,</span> <span class="va">T3</span>.<span class="va">Properties</span>.<span class="va">VariableNames</span>{<span class="va">i</span>})<span class="op">;</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<table>
<thead>
<tr class="header">
<th><img src="VFKWgwosLTIN.png" alt="" width="70%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>総当たりの散布図</strong></td>
</tr>
</tbody>
</table>
<p>総当たりの相関係数を計算する。</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="va">corrcoef</span>(<span class="va">ary3</span>)  <span class="co">% 相関係数行列</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">% 以下は結果。</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="va">ans</span> <span class="op">=</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.0000</span>    <span class="fl">0.9707</span>    <span class="fl">0.5158</span>    <span class="fl">0.6151</span>    <span class="fl">0.1074</span>    <span class="fl">0.6942</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.9707</span>    <span class="fl">1.0000</span>    <span class="fl">0.4617</span>    <span class="fl">0.5960</span>    <span class="fl">0.1051</span>    <span class="fl">0.7111</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.5158</span>    <span class="fl">0.4617</span>    <span class="fl">1.0000</span>    <span class="fl">0.7337</span>    <span class="fl">0.0814</span>    <span class="fl">0.6762</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.6151</span>    <span class="fl">0.5960</span>    <span class="fl">0.7337</span>    <span class="fl">1.0000</span>    <span class="fl">0.1492</span>    <span class="fl">0.6706</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.1074</span>    <span class="fl">0.1051</span>    <span class="fl">0.0814</span>    <span class="fl">0.1492</span>    <span class="fl">1.0000</span>   <span class="op">-</span><span class="fl">0.0345</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.6942</span>    <span class="fl">0.7111</span>    <span class="fl">0.6762</span>    <span class="fl">0.6706</span>   <span class="op">-</span><span class="fl">0.0345</span>    <span class="fl">1.0000</span></span></code></pre></div>
<p>列名と行名がわからないので多少わかりにくい。テーブル型にしておこう。</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="va">r</span> <span class="op">=</span> <span class="va">corrcoef</span>(<span class="va">ary3</span>)<span class="op">;</span> <span class="co">% 相関係数行列をrに代入</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="va">tr3</span> <span class="op">=</span> <span class="va">array2table</span>(<span class="va">r</span>)<span class="op">;</span> <span class="co">% r(配列型)をtr3 (テーブル型)に変換</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">% T3テーブルの変数名を、tr3テーブルの列名(VariableNames)にコピー</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="va">tr3</span>.<span class="va">Properties</span>.<span class="va">VariableNames</span> <span class="op">=</span> <span class="va">T3</span>.<span class="va">Properties</span>.<span class="va">VariableNames</span><span class="op">;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">% T3テーブルの変数名を、tr3テーブルの行名(RowNames)にコピー</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="va">tr3</span>.<span class="va">Properties</span>.<span class="va">RowNames</span> <span class="op">=</span> <span class="va">T3</span>.<span class="va">Properties</span>.<span class="va">VariableNames</span><span class="op">;</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="va">tr3</span></span></code></pre></div>
<p>結果</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">tr3</span> <span class="op">=</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                 <span class="va">lifeFemale</span>    <span class="va">lifeMale</span>    <span class="va">alcohol</span>     <span class="va">smokeFemale</span>    <span class="va">smokeMale</span>       <span class="va">GDP</span>   </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>                   __________    ________    ________    ___________    _________    _________</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">lifeFemale</span>            <span class="fl">1</span>      <span class="fl">0.97073</span>      <span class="fl">0.51576</span>      <span class="fl">0.61511</span>        <span class="fl">0.10737</span>      <span class="fl">0.69419</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">lifeMale</span>        <span class="fl">0.97073</span>            <span class="fl">1</span>       <span class="fl">0.4617</span>      <span class="fl">0.59598</span>        <span class="fl">0.10511</span>      <span class="fl">0.71111</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">alcohol</span>         <span class="fl">0.51576</span>       <span class="fl">0.4617</span>            <span class="fl">1</span>      <span class="fl">0.73369</span>       <span class="fl">0.081434</span>      <span class="fl">0.67616</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">smokeFemale</span>     <span class="fl">0.61511</span>      <span class="fl">0.59598</span>      <span class="fl">0.73369</span>            <span class="fl">1</span>        <span class="fl">0.14917</span>      <span class="fl">0.67058</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">smokeMale</span>       <span class="fl">0.10737</span>      <span class="fl">0.10511</span>     <span class="fl">0.081434</span>      <span class="fl">0.14917</span>              <span class="fl">1</span>    <span class="op">-</span><span class="fl">0.034526</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">GDP</span>             <span class="fl">0.69419</span>      <span class="fl">0.71111</span>      <span class="fl">0.67616</span>      <span class="fl">0.67058</span>      <span class="op">-</span><span class="fl">0.034526</span>            <span class="fl">1</span></span></code></pre></div>
<p>散布図を見ると男女の寿命には相関関係がある(図)のはなんとなくうなづけるが男女の寿命は喫煙量と正の相関を持つ。これは喫煙するほど寿命が延びる傾向があることを意味する。また、男女の寿命はアルコール摂取量とも正の相関がある。お酒を飲むほど長寿というが、ここまで顕著に出るだろうか。</p>
<table>
<thead>
<tr class="header">
<th><img src="VFKWgwosLTIN.png" alt="" width="70%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>総当たりの散布図 (再掲)</strong></td>
</tr>
</tbody>
</table>
<h4 id="疑似相関">疑似相関</h4>
<p>実は、GDPが大きいと所得が大きいため、アルコールなどの嗜好品を楽しむ傾向がある(正の相関がある)と同時に、GDPが大きいと医療や栄養状態が良好なため、寿命が延びる傾向がある。結果、寿命とアルコール、寿命と喫煙について、<strong>見かけの相関</strong>が見られたと考えられる(図)。このように、第三の変数が介在することによって疑似相関が発生することに注意しなくてはならない。</p>
<table>
<thead>
<tr class="header">
<th><img src="pseudo_cor.png" alt="" width="50%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>見かけの相関</strong></td>
</tr>
</tbody>
</table>
<h4 id="ネットワークグラフ">ネットワークグラフ</h4>
<p>二者間の関係性を示す任意の尺度に基づいてネットワークグラフを作成する関数<code>drawNetworkGraphT</code>を作りました。https://github.com/qikushu/stat/blob/master/matlab/drawNetworkGraphT.m
からダウンロードして、MATLABにドラッグしてインストールしてください。以下のように実行してください</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="va">drawNetworkGraphT</span>(<span class="va">tr3</span><span class="op">,</span><span class="fl">3</span>)<span class="op">;</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">drawNetworkGraphT</span>(<span class="va">tr3</span><span class="op">,</span><span class="fl">10</span>)<span class="op">;</span> <span class="co">% 好みによって線の太さを太くする。</span></span></code></pre></div>
<p>正の値を赤、負の値を青で示します。各項目間の擬似相関を確認してください</p>
<h4 id="偏相関係数">偏相関係数</h4>
<p>偏相関係数を計算すると、着目している二者以外の因子を統計的に除去した後に、相関係数を計算することができる。<code>partialcorr</code>関数は
Statistics and Machine Learning Toolbox に含まれている。</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>[<span class="va">pr</span><span class="op">,</span> <span class="va">p</span>] <span class="op">=</span> <span class="va">partialcorr</span>(<span class="va">ary3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="va">pr</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="va">pr</span> <span class="op">=</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="fl">1.0000</span>    <span class="fl">0.9452</span>    <span class="fl">0.3152</span>    <span class="fl">0.0087</span>   <span class="op">-</span><span class="fl">0.0329</span>   <span class="op">-</span><span class="fl">0.1967</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.9452</span>    <span class="fl">1.0000</span>   <span class="op">-</span><span class="fl">0.3568</span>    <span class="fl">0.0773</span>    <span class="fl">0.0789</span>    <span class="fl">0.3646</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.3152</span>   <span class="op">-</span><span class="fl">0.3568</span>    <span class="fl">1.0000</span>    <span class="fl">0.4925</span>    <span class="fl">0.0623</span>    <span class="fl">0.4368</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.0087</span>    <span class="fl">0.0773</span>    <span class="fl">0.4925</span>    <span class="fl">1.0000</span>    <span class="fl">0.1410</span>    <span class="fl">0.1496</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span><span class="fl">0.0329</span>    <span class="fl">0.0789</span>    <span class="fl">0.0623</span>    <span class="fl">0.1410</span>    <span class="fl">1.0000</span>   <span class="op">-</span><span class="fl">0.2320</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>   <span class="op">-</span><span class="fl">0.1967</span>    <span class="fl">0.3646</span>    <span class="fl">0.4368</span>    <span class="fl">0.1496</span>   <span class="op">-</span><span class="fl">0.2320</span>    <span class="fl">1.0000</span></span></code></pre></div>
<p>ネットワークグラフの描画</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">drawNetworkGraphT</span>(<span class="va">pr</span><span class="op">,</span><span class="fl">10</span>)<span class="op">;</span> </span></code></pre></div>
<p>偏相関係数を見ると、男性の寿命とアルコールには負の相関があり、常識にあう(図)。寿命と喫煙についてはほぼ無相関である。アルコールと男性の喫煙は相関がほとんどないが、アルコールと女性の喫煙は相関がある。おそらく男女で喫煙とアルコールの関連の仕方が異なるのだろう。</p>
<h4 id="順位相関-ノンパラメトリック解析">順位相関
(ノンパラメトリック解析)</h4>
<p>順位に変換した表をにしめす。順位尺度に関する計量データの相関を測定する統計量として、<strong>スピアマンの順位相関</strong>
や <strong>ケンドールの順位相関</strong>
が知られる。ノンパラメトリック分析ではパラメトリック分析とは異なり、特定の確率分布に依存しないため、汎用性がたかい。一般的には検出力が低いといわれるが、パラメトリック分析にて仮定する前提の確率分布が現実と適合しない場合、無理やりパラメトリック分析を行うより、ノンパラメトリック分析のほうが妥当である場合がある。</p>
<table>
<thead>
<tr class="header">
<th>経験年数順位</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>総水銀量順位</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>3</td>
<td>5</td>
<td>9</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">url2</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/qikushu/stat/master/mercury_rank.txt&quot;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="va">d2</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url2</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">year_rank</span> <span class="va">mercury_rank</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fl">1</span>         <span class="fl">1</span>            <span class="fl">2</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="fl">2</span>         <span class="fl">2</span>            <span class="fl">1</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fl">3</span>         <span class="fl">3</span>            <span class="fl">4</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fl">4</span>         <span class="fl">4</span>            <span class="fl">6</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fl">5</span>         <span class="fl">5</span>            <span class="fl">7</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fl">6</span>         <span class="fl">6</span>            <span class="fl">8</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fl">7</span>         <span class="fl">7</span>            <span class="fl">3</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="fl">8</span>         <span class="fl">8</span>            <span class="fl">5</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fl">9</span>         <span class="fl">9</span>            <span class="fl">9</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="co">% 散布図</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="va">scatter</span>(<span class="va">d2</span>.<span class="va">year_rank</span><span class="op">,</span> <span class="va">d2</span>.<span class="va">mercury_rank</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">&#39;Year_rank&#39;</span>)<span class="op">;</span> <span class="co">% X軸のラベルを設定</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">&#39;Mercury_rank&#39;</span>)<span class="op">;</span> <span class="co">% Y軸のラベルを設定</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a><span class="va">title</span>(<span class="ss">&#39;順位尺度の散布図&#39;</span>)<span class="op">;</span> <span class="co">% グラフのタイトルを設定</span></span></code></pre></div>
<p><strong>スピアマンの順位相関</strong>は、ピアソンの相関係数の計算をそのまま順位に対して適用したものである。変数間の単調な関係を測定し、データが正規分布に従わない場合や外れ値が存在する場合に有用である。</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">% スピアマンの順位相関  順位データに対してピアソンの相関係数を計算</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="va">corr</span>(<span class="va">d2</span>.<span class="va">year_rank</span><span class="op">,</span> <span class="va">d2</span>.<span class="va">mercury_rank</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">% 生データから、スピアマンの順位相関係数の計算</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>[<span class="va">rho</span><span class="op">,</span> <span class="va">p</span>] <span class="op">=</span> <span class="va">corr</span>(<span class="va">d</span>.<span class="va">year</span><span class="op">,</span> <span class="va">d</span>.<span class="va">mercury</span><span class="op">,</span> <span class="ss">&#39;Type&#39;</span><span class="op">,</span> <span class="ss">&#39;Spearman&#39;</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">% rhoがスピアマンの順位相関係数である</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">% pは帰無仮説が無相関の時にrhoが得られる確率である。5%水準で検定する。</span></span></code></pre></div>
<p><strong>ケンドールの順位相関</strong>は、<span
class="math inline">\(n\)</span>対のデータから任意の二対選択するのは<span
class="math inline">\(_nC_2\)</span>通り考えられる。対について比較したときの正負を見たときに、正正、負負なら同方向(順方向)の数としてカウント(G)し、、正負、負正なら逆方向の数としてカウント(H)する。<span
class="math inline">\(G-H/(n(n-1)/2)\)</span>を相関係数とする。</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">% ケンドールの順位相関</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>[<span class="va">tau</span><span class="op">,</span> <span class="va">p</span>] <span class="op">=</span> <span class="va">corr</span>(<span class="va">d</span>.<span class="va">year</span><span class="op">,</span> <span class="va">d</span>.<span class="va">mercury</span><span class="op">,</span> <span class="ss">&#39;Type&#39;</span><span class="op">,</span> <span class="ss">&#39;Kendall&#39;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">% tauがケンドールの順位相関係数である。</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co">% pは帰無仮説が無相関の時にtauが得られる確率である。5%水準で検定する。</span></span></code></pre></div>
<h3 id="回帰">回帰</h3>
<p>2変数<span class="math inline">\(x\)</span>と<span
class="math inline">\(y\)</span>について、<span
class="math inline">\(x\)</span>の大きさが<span
class="math inline">\(y\)</span>の大きさを決定している関係があるとき、
<span class="math inline">\(x\)</span>を <strong>独立変数</strong>
、<span class="math inline">\(y\)</span>を <strong>従属変数</strong>
という。回帰の例として、父親とその息子の身長に関するデータについて紹介する。通常、生物の形質は、遺伝的な要因とそれ以外(環境要因という)に区別されうる。身長は遺伝子の影響が大きい形質だから親の身長と子供の身長には、遺伝的な関連が見えてきやすい。データは統計教育推進委員会教育教材サイトより引用した(http://www.jfssa.jp/statedu/)}。</p>
<p>親の身長が子供に遺伝するので、父親の身長が独立変数<span
class="math inline">\(x=(x_1, x_2, \cdots,
x_n)\)</span>としたときに、息子の身長を従属変数<span
class="math inline">\(y=(y_1, y_2, \cdots, y_n)\)</span>とし、父親(<span
class="math inline">\(x\)</span>)の身長にしたがって、息子(<span
class="math inline">\(y\)</span>)の身長が増加する、あるいは減少すると考え、
<span class="math display">\[
    y=ax+b
\]</span>
によって、二値の傾向が「要約」される、別の言い方では、xの値でyの予測値が得られる」と考える(図)。これを<strong>線形回帰</strong>といい、この直線を<strong>回帰直線</strong>という。<span
class="math inline">\(a\)</span>を <strong>傾き(slope)</strong> 、<span
class="math inline">\(b\)</span>を <strong>切片(intercept)</strong>
という。<span class="math inline">\(y\)</span>は<span
class="math inline">\(\hat{y}=ax+b\)</span>により予測されると考え、<span
class="math inline">\(\hat{y}\)</span>を<strong>予測値</strong>という。<span
class="math inline">\(y\)</span>が<span
class="math inline">\(x\)</span>の線形関数で回帰する場合を<strong>線形回帰</strong>、二次関数などのように線形関数でない関数にて回帰する場合を<strong>非線形回帰</strong>という。</p>
<table>
<thead>
<tr class="header">
<th><img src="N0I3BIX6.png" alt="" width="50%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>親子回帰</strong></td>
</tr>
</tbody>
</table>
<h4 id="散布図の作成">散布図の作成</h4>
<p>二次元の散布図を作成する。</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データ読み込み</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">url4</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/qikushu/stat/master/height_reg.txt&quot;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="va">d4</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url4</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co">% 散布図の書き方1</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="va">scatter</span>(<span class="va">d4</span>.<span class="va">father</span><span class="op">,</span> <span class="va">d4</span>.<span class="va">son</span>)</span></code></pre></div>
<h4 id="最小二乗法">最小二乗法</h4>
<p>息子の身長の実測値<span
class="math inline">\(y\)</span>は、父親の身長を<span
class="math inline">\(x\)</span>としたとき、<span
class="math inline">\(\hat{y}=ax+b\)</span>により予測されるが、必ず誤差<span
class="math inline">\(e=(e_1, e_2, \cdots,
e_n)\)</span>がある。すなわち、任意の<span class="math inline">\(i=1, 2,
\cdots , n\)</span>について、 <span class="math display">\[
    y_i = ax_i + b + e_i
\]</span> である。移項して <span class="math display">\[
    e_i  = y_i - (ax_i + b)
\]</span> 両辺絶対値を取って <span class="math display">\[
    |e_i|  = |y_i - (ax_i + b)|
\]</span> ここでi=1…nまでの総和を取って <span class="math display">\[
    \sum_{i=1}^n |e_i|  = \sum_{i=1}^n |y_i - (ax_i + b)|
\]</span> を考える。左辺は誤差の絶対値の総和<span
class="math inline">\(\sum_{i=1}^n|e_i|\)</span>であり、これを最小にするときの<span
class="math inline">\(ax+b\)</span>を求めると、当てはまりがよさそうである。ここで、<span
class="math inline">\(\sum_{i=1}^n|e_i|\)</span>が最小の時、<span
class="math inline">\(\sum_{i=1}^n(e_i)^2\)</span>も最小であるため、数学的な性質の良さから、代わりに
<span class="math display">\[
    \sum_{i=1}^n (e_i)^2  = \sum_{i=1}^n (y_i - (ax_i + b))^2
\]</span> を最小化する<span class="math inline">\(a\)</span>と<span
class="math inline">\(b\)</span>を求める。これを<strong>最小二乗法</strong>という。その解を<span
class="math inline">\(\hat{a}\)</span>(<span
class="math inline">\(a\)</span>ハット)と<span
class="math inline">\(\hat{b}\)</span>(<span
class="math inline">\(b\)</span>ハット)とすると、 <span
class="math display">\[
    \hat{a} = \frac{  x\text{と}y\text{の共分散}  } { x\text{の不偏分散}
} = \frac{  s_{xy}^2  } { s_x^2 } \\
    \hat{b} = \bar{y} - \hat{a} \bar{x}
\]</span> であることが証明されている。</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="va">fa</span> <span class="op">=</span> <span class="va">d4</span>.<span class="va">father</span>  <span class="co">% 父親の身長を取り出す</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="va">son</span> <span class="op">=</span> <span class="va">d4</span>.<span class="va">son</span>  <span class="co">% 息子の身長を取り出す</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="va">cov</span>(<span class="va">fa</span><span class="op">,</span><span class="va">son</span>)  <span class="co">% 父親と息子の(不偏)共分散</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="va">var</span>(<span class="va">fa</span>)  <span class="co">% 父親の不偏分散</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="va">a</span> <span class="op">=</span> <span class="va">cov</span>(<span class="va">fa</span><span class="op">,</span><span class="va">son</span>)<span class="op">/</span><span class="va">var</span>(<span class="va">fa</span>)  <span class="co">% 回帰直線の傾き</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="va">mfa</span> <span class="op">=</span> <span class="va">mean</span>(<span class="va">fa</span>) <span class="co">% 父親の平均値</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="va">mson</span> <span class="op">=</span> <span class="va">mean</span>(<span class="va">son</span>)  <span class="co">% 息子の平均値</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="va">b</span> <span class="op">=</span> <span class="va">mson</span> <span class="op">-</span> <span class="va">a</span> <span class="op">*</span> <span class="va">mfa</span></span></code></pre></div>
<p>分散分析と線形回帰は線形代数による表現では等価であり、線形モデルとして一般化されている。そのため、分散分析を行う際に用いた<code>fitlm</code>関数がここでも用いられる。</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 回帰分析 (線形モデル)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">d4</span><span class="op">,</span> <span class="ss">&#39;son ~ father&#39;</span>)<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="va">lm</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co">% 結果の確認</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="va">Linear</span> <span class="va">regression</span> <span class="va">model</span><span class="op">:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">son</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">father</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="va">Estimated</span> <span class="va">Coefficients</span><span class="op">:</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>                   <span class="va">Estimate</span>       <span class="va">SE</span>       <span class="va">tStat</span>       <span class="va">pValue</span>  </span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                   ________    ________    ______    __________</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    (<span class="va">Intercept</span>)      <span class="fl">120.1</span>        <span class="fl">13.16</span>    <span class="fl">9.1259</span>    <span class="fl">3.4317e-15</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">father</span>         <span class="fl">0.30663</span>     <span class="fl">0.076663</span>    <span class="fl">3.9997</span>    <span class="fl">0.00011412</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="va">Number</span> <span class="va">of</span> <span class="va">observations</span><span class="op">:</span> <span class="fl">114</span><span class="op">,</span> <span class="va">Error</span> <span class="va">degrees</span> <span class="va">of</span> <span class="va">freedom</span><span class="op">:</span> <span class="fl">112</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="va">Root</span> <span class="va">Mean</span> <span class="va">Squared</span> <span class="va">Error</span><span class="op">:</span> <span class="fl">4.98</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="va">R</span><span class="op">-</span><span class="va">squared</span><span class="op">:</span> <span class="fl">0.125</span><span class="op">,</span>  <span class="va">Adjusted</span> <span class="va">R</span><span class="op">-</span><span class="va">Squared</span><span class="op">:</span> <span class="fl">0.117</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="va">F</span><span class="op">-</span><span class="va">statistic</span> <span class="va">vs</span>. <span class="va">constant</span> <span class="va">model</span><span class="op">:</span> <span class="fl">16</span><span class="op">,</span> <span class="va">p</span><span class="op">-</span><span class="va">value</span> <span class="op">=</span> <span class="fl">0.000114</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">% 回帰直線を図に書き加える</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span>  <span class="co">% 現在の図にプロットを追加するため</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a><span class="co">% 回帰直線の計算</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="va">xFit</span> <span class="op">=</span> <span class="va">linspace</span>(<span class="va">min</span>(<span class="va">d4</span>.<span class="va">father</span>)<span class="op">,</span> <span class="va">max</span>(<span class="va">d4</span>.<span class="va">father</span>)<span class="op">,</span> <span class="fl">100</span>)<span class="op">&#39;;</span>  <span class="co">% フィット用のx値</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a><span class="va">yFit</span> <span class="op">=</span> <span class="va">predict</span>(<span class="va">lm</span><span class="op">,</span> <span class="va">xFit</span>)<span class="op">;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a><span class="co">% 回帰直線の描画</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">xFit</span><span class="op">,</span> <span class="va">yFit</span><span class="op">,</span> <span class="ss">&#39;r-&#39;</span>)<span class="op">;</span>  <span class="co">% 赤い線でプロット</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span>  <span class="co">% 追加プロットの終了</span></span></code></pre></div>
<p><code>son ~ father</code>はモデル式であり、<code>father</code>を独立変数、<code>son</code>を従属変数として線形回帰を行うという意味である。<code>Coefficients</code>は「係数」、<code>Estimate</code>は「推定値」を表す。<code>(Intercept)</code>が切片<span
class="math inline">\(\hat{b}\)</span>、<code>father</code>が傾き<span
class="math inline">\(\hat{a}\)</span>に相当する。つまり、回帰直線は<span
class="math inline">\(y=0.30663x+120.1\)</span>と推定された。</p>
<h4 id="回帰分析がしていること">回帰分析がしていること。</h4>
<p>回帰分析の結果について、検定を行うことができる。回帰直線(予測式)は、
<span class="math display">\[ \hat{y} = \hat{a}x+\hat{b}\]</span>
とあらわされるが、最小二乗法の公式、<span class="math inline">\(\hat{b}
= \bar{y} - \hat{a} \bar{x}\)</span>を代入すると、 <span
class="math display">\[ \hat{y} = \hat{a}x+\bar{y} - \hat{a}
\bar{x}\]</span> である。<span class="math inline">\(x =
\bar{x}\)</span>のとき、 <span class="math display">\[ \hat{y} = \bar{y}
\]</span> である。これは回帰直線は任意の<span
class="math inline">\(a\)</span>、<span
class="math inline">\(b\)</span>に関わらず、点<span
class="math inline">\((\bar{x},
\bar{y})\)</span>を必ず通ることを示している。回帰分析とは点<span
class="math inline">\((\bar{x},
\bar{y})\)</span>の周りに回帰直線をくるくる回転させて、最適な<span
class="math inline">\(a\)</span>と<span
class="math inline">\(b\)</span>を探し、得られたのが<span
class="math inline">\(\hat{a}\)</span>と<span
class="math inline">\(\hat{b}\)</span>というわけだ。</p>
<h4 id="回帰係数の検定">回帰係数の検定</h4>
<p><span class="math inline">\(\hat{a}\)</span>あるいは<span
class="math inline">\(\hat{b}\)</span>を推定値の標準誤差<code>SE</code>にて割った値はなんと<span
class="math inline">\(t\)</span>分布に従うことがわかっている。なのでt値<code>tstat</code>で有意性を検定する。<span
class="math inline">\(\hat{a}\)</span>と<span
class="math inline">\(\hat{b}\)</span>の<span
class="math inline">\(t\)</span>値をそれぞれ<span
class="math inline">\(t_a\)</span>および<span
class="math inline">\(t_b\)</span>とおくと <span class="math display">\[
    t_b = \frac{ \hat{b} } {SE}  = \frac{ 120.09784 } {13.16008} =
9.1259 \text{(自由度はn-2)}\\
    t_a = \frac{ \hat{a} } {SE}  = \frac{ 0.30663 } {0.07666} = 3.9999
\text{(自由度はn-2)}
\]</span> である。帰無仮説(<span
class="math inline">\(H_0\)</span>)は「推定値は0」として有意性を判定する。
0.1%、1%、5%水準にて有意の場合、***、**、*が付される。<code>father</code>の項には***が付いており、0.1%水準で有意であり、<code>son</code>の身長は<code>father</code>の身長により説明される、といってよい。多くの場合切片は有意(0でない)ので、傾きの有意性が重要である。</p>
<h4 id="決定係数">決定係数</h4>
<p><code>R-squared</code>は寄与率あるいは決定係数<span
class="math inline">\(R^2\)</span>といい、 <span class="math display">\[
    R^2 = 1 - \frac { \sum{(y_i - \hat{y})^2}}{\sum{(y_i - \bar{y})^2}}
\]</span> である。<span class="math inline">\(\sum{(y_i - \hat{y})^2} /
\sum{(y_i -
\bar{y})^2}\)</span>のうち、分子について考えよう。観察値と予測値の誤差<span
class="math inline">\(y_i -
\hat{y}\)</span>が少ないほうが当てはまりが良いといえる。対立仮説(<span
class="math inline">\(H_1\)</span>)「<span class="math inline">\(a \neq
0\)</span>」が真のときの各<span
class="math inline">\(y_i\)</span>と予測値<span
class="math inline">\(\hat{y}\)</span>の誤差平方和(<span
class="math inline">\(SS_{H_1}\)</span>)を考えると <span
class="math display">\[
    SS_{H_1} = \sum{(y_i - \hat{y})^2}
\]</span> である。次は分母。回帰分析における帰無仮説(<span
class="math inline">\(H_0\)</span>)「<span
class="math inline">\(a=0\)</span>」が真のとき、前述のとおり、最小二乗法の公式<span
class="math inline">\(\hat{b} = \bar{y} - \hat{a}
\bar{x}\)</span>に<span
class="math inline">\(\hat{a}=0\)</span>を代入すると、 <span
class="math display">\[
\hat{b} = \bar{y} = \hat{y}
\]</span> である。回帰直線<span class="math inline">\(\hat{y} = \hat{a}x
+ \hat{b}\)</span>に、帰無仮説の<span
class="math inline">\(\hat{a}=0\)</span>および上記より<span
class="math inline">\(\hat{b} = \hat{y}\)</span>を代入すると <span
class="math display">\[
\hat{y} = \bar{y}
\]</span> である。以上より、帰無仮説(<span
class="math inline">\(H_0\)</span>)<span
class="math inline">\(における各\)</span>y_i<span
class="math inline">\(と予測値\)</span><span
class="math inline">\(の誤差平方和(\)</span>SS_{H_0}$)は <span
class="math display">\[
    SS_{H_0} = \sum{(y_i - \bar{y})^2}
\]</span> である。なので</p>
<p><span class="math display">\[
    R^2 = 1 - \frac { SS_{H_1}}{SS_{H_0}}
\]</span>
と大きく捉えよう。観測値がほぼ回帰直線上に乗っている場合、分子はほぼ0になり、決定係数は1に近づく。逆に観測値が回帰直線とは無関係のとき、分子は分母とほぼ等しくなるので、決定係数は0になる。決定係数は相関係数と関連が深く、単回帰分析の場合は<span
class="math inline">\(r^2\)</span>の平方根は相関係数<span
class="math inline">\(r\)</span>と等しい<code>Adjusted R-squaredは</code>調整済み寄与率あるいは調整済み決定係数という。</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 確かめ</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="va">corr</span>(<span class="va">fa</span><span class="op">,</span> <span class="va">son</span>)  <span class="co">% ピアソンの相関係数  (r)</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fl">0.3535</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="va">corr</span>(<span class="va">fa</span><span class="op">,</span> <span class="va">son</span>)<span class="op">^</span><span class="fl">2</span>  <span class="co">% ピアソンの相関係数の二乗 (r^2)</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fl">0.1250</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 決定係数R-squaredと等しい</span></span></code></pre></div>
<h3 id="第六回演習のレポート課題">第六回演習のレポート課題</h3>
<ol type="1">
<li><strong>散布図の作成</strong>
ある植物の移植後の経過週数と草丈の関係を調査し、次表のような結果を得た</li>
</ol>
<table>
<thead>
<tr class="header">
<th>Week</th>
<th>Height</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>8.5</td>
<td>86.9</td>
</tr>
<tr class="even">
<td>5.8</td>
<td>65.5</td>
</tr>
<tr class="odd">
<td>7.0</td>
<td>68.5</td>
</tr>
<tr class="even">
<td>9.5</td>
<td>96.4</td>
</tr>
<tr class="odd">
<td>8.7</td>
<td>83.1</td>
</tr>
<tr class="even">
<td>3.0</td>
<td>17.7</td>
</tr>
<tr class="odd">
<td>6.9</td>
<td>72.3</td>
</tr>
<tr class="even">
<td>4.7</td>
<td>51.3</td>
</tr>
<tr class="odd">
<td>4.8</td>
<td>44.2</td>
</tr>
<tr class="even">
<td>5.8</td>
<td>69.6</td>
</tr>
<tr class="odd">
<td>5.3</td>
<td>45.6</td>
</tr>
<tr class="even">
<td>7.9</td>
<td>79.3</td>
</tr>
<tr class="odd">
<td>6.5</td>
<td>64.3</td>
</tr>
<tr class="even">
<td>5.2</td>
<td>60.1</td>
</tr>
<tr class="odd">
<td>5.9</td>
<td>66.2</td>
</tr>
</tbody>
</table>
<p>以上のデータについて、二次元の散布図を作成せよ。</p>
<ol start="2" type="1">
<li><strong>ピアソンの相関係数</strong>
問題1のデータについてピアソンの相関係数を求めよ。</li>
<li><strong>無相関検定</strong>
問題2にて得られた相関係数の有意性について<span
class="math inline">\(t\)</span>検定にて検定せよ。</li>
<li><strong>ノンパラメトリック相関解析への準備</strong>
問題1の表を順位尺度に変換して示せ。</li>
<li><strong>スピアマンの相関解析</strong>
問題4の順位表から、スピアマンの順位相関係数を求めよ。</li>
<li><strong>ケンドールの相関解析</strong>
問題4の順位表から、ケンドールの順位相関係数を求めよ。</li>
<li><strong>回帰分析</strong> 問題1の表から、回帰直線を求めよ。</li>
<li><strong>回帰分析</strong> 求めた回帰直線から、8, 9,
10週目における草丈を予測せよ。</li>
</ol>
<div class="sourceCode" id="cb20"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="va">url</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/qikushu/stat/master/kadai7-2.txt&quot;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">d</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url</span>)</span></code></pre></div>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
