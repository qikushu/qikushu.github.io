<!doctype html>
<html >
<head>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!--[if lt IE 9]>
                <script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
        <![endif]-->
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />

    <!-- <link rel="stylesheet" type="text/css" href="template.css" /> -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/template.css" />

    <link href="https://vjs.zencdn.net/5.4.4/video-js.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
    <!-- <script type='text/javascript' src='menu/js/jquery.cookie.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.hoverIntent.minified.js'></script> -->
    <!-- <script type='text/javascript' src='menu/js/jquery.dcjqaccordion.2.7.min.js'></script> -->

    <!-- <link href="menu/css/skins/blue.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/graphite.css" rel="stylesheet" type="text/css" /> -->
    <!-- <link href="menu/css/skins/grey.css" rel="stylesheet" type="text/css" /> -->
  
    <!-- <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
        
  
    <!-- <script src="script.js"></script> -->
  
    <!-- <script src="jquery.sticky-kit.js "></script> -->
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.cookie.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.hoverIntent.minified.js'></script>
    <script type='text/javascript' src='https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/js/jquery.dcjqaccordion.2.7.min.js'></script>

    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/blue.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/graphite.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/menu/css/skins/grey.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/gh/ryangrose/easy-pandoc-templates@948e28e5/css/elegant_bootstrap.css" rel="stylesheet" type="text/css" />
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/script.js"></script>
  
    <script src="https://cdn.jsdelivr.net/gh/diversen/pandoc-bootstrap-adaptive-template@959c3622/jquery.sticky-kit.js"></script>
    <meta name="generator" content="pandoc" />
  <meta name="author" content="Yoshiyuki Yamagata" />
  <title>2023生物統計学第7回</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <script
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"
  type="text/javascript"></script>
</head>
<body>

    
    <div class="navbar navbar-static-top">
    <div class="navbar-inner">
      <div class="container">
        <span class="doc-title">2023生物統計学第7回</span>
        <ul class="nav pull-right doc-info">
                    <li><p class="navbar-text">Yoshiyuki
Yamagata</p></li>
                              <li><p class="navbar-text">2023年11月26日</p></li>
                  </ul>
      </div>
    </div>
  </div>
    <div class="container">
    <div class="row">
            <div class="span12">

      
      <h1 id="生物統計演習-第7回-実験計画重回帰">生物統計演習 第7回
実験計画、重回帰</h1>
<h2 id="実験計画について">実験計画について</h2>
<p>実験には労力も時間もお金もかかるため、少数の実験で効率の良い実験を行う必要がある。一方で、本来は有意差があるのにそれを検出できる反復数が少ないために、結果的に「有意差なし」となる可能性もある。
実験を行う前に、慎重かつ適切な実験の設計が重要である。<strong>「実験計画」</strong>は統計学的な根拠を基に実験計画を立てる際の指針を与えるものである。</p>
<h2 id="検出力の分析">検出力の分析</h2>
<h3 id="第一種過誤と第二種過誤">第一種過誤と第二種過誤</h3>
<p><strong>図. 第一種過誤と第二種過誤</strong></p>
<p><img src="https://raw.githubusercontent.com/qikushu/qikushu.github.io/master/biostat/nvPYkq6ucGBI.png" width="500"></p>
<ol type="1">
<li><strong>第一種過誤</strong> 帰無仮説<span
class="math inline">\((H_0)\)</span>が真(正しい)の時に、誤って、対立仮説<span
class="math inline">\((H_1)\)</span>を採択する確率である。有意水準<span
class="math inline">\(\alpha\)</span>である。 <span
class="math inline">\(t\)</span>検定の場合は、本来有意差がない<span
class="math inline">\((H_0)\)</span>のに有意差がある<span
class="math inline">\((H_1)\)</span>と結論する確率である。偽陽性ともいう。</li>
<li><strong>第二種過誤</strong> 帰無仮説<span
class="math inline">\((H_0)\)</span>が偽(正しくない)の時に、誤って、帰無仮説<span
class="math inline">\((H_0)\)</span>を採択する確率である。<span
class="math inline">\(\beta\)</span>にてしめす。 <span
class="math inline">\(t\)</span>検定の場合は、本来有意差がある<span
class="math inline">\((H_1)\)</span>のに有意差がない<span
class="math inline">\((H_0)\)</span>と結論する確率である。偽陰性ともいう。</li>
<li><strong>検出力</strong> 帰無仮説<span
class="math inline">\((H_0)\)</span>が偽(正しくない)の時に対立仮説<span
class="math inline">\((H_1)\)</span>を採択する確率である。<span
class="math inline">\(1-\beta\)</span>にてしめす。<span
class="math inline">\(t\)</span>検定の場合は、本来ある有意差を検出する確率である。</li>
</ol>
<p><strong>検出力を求める手順 (図)</strong> 1. 真実が<span
class="math inline">\((H_0)\)</span>の立場では平均0の<span
class="math inline">\(t\)</span>分布に従う。 1.
棄却域が0.05のときを有意水準<span
class="math inline">\(\alpha\)</span>として定める(図では両側確率を想定)。
1. その時の上側および下側限界を得る。 1. 一方、真実が<span
class="math inline">\((H_1)\)</span>の立場では平均<span
class="math inline">\(\Delta d\)</span>の非心<span
class="math inline">\(t\)</span>分布に従う。 1.
先ほど求めた上側および下側限界を当てはめる。 1. <span
class="math inline">\(\Delta d\)</span>が正の時は上側限界より下側
(図では桃色)の面積が第二種過誤の 確率(<span
class="math inline">\(\beta\)</span>)である。逆に検出力
(図では橙色)は<span
class="math inline">\(1-\beta\)</span>に対応する。<span
class="math inline">\(\Delta d\)</span>が負の時は逆に考える。</p>
<p>※
t分布は通常t=0について左右対称である。非心t分布は、ざっくりいうと、左右に平行に移動したものである。心(中心)が0に非ずで「非心」という意味だろうか。以下のグラフでは青がt分布を1.291平行移動したもの、赤が1.291が平均の非心t分布である。形は少し違うので注意する。</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">% xの範囲を指定する。-5から5まで101このデータを生成する。</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="va">linspace</span>(<span class="op">-</span><span class="fl">5</span><span class="op">,</span> <span class="fl">5</span><span class="op">,</span> <span class="fl">101</span>)<span class="op">;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">%今回は自由度は18とする。</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="va">df</span> <span class="op">=</span> <span class="fl">18</span><span class="op">;</span>  <span class="co">% 自由度</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">% t分布の確率密度関数に上記のxベクトルを代入して</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">% 値を計算する。ただし、平均を1.291にシフトしている。</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="va">y3</span> <span class="op">=</span> <span class="va">tpdf</span>(<span class="va">x</span> <span class="op">-</span> <span class="fl">1.291</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 非心t分布の確率密度関数も同様に作成する</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="va">nc</span> <span class="op">=</span> <span class="fl">1.291</span><span class="op">;</span>  <span class="co">% 非心パラメータ</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="va">y2</span> <span class="op">=</span> <span class="va">nctpdf</span>(<span class="va">x</span><span class="op">,</span> <span class="va">df</span><span class="op">,</span> <span class="va">nc</span>)<span class="op">;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">% プロットしてみる</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">x</span><span class="op">,</span> <span class="va">y2</span><span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;blue&#39;</span>)<span class="op">;</span>  <span class="co">% 青</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span>  <span class="co">% 同じグラフに複数のプロットを追加</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">x</span><span class="op">,</span> <span class="va">y3</span><span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;red&#39;</span>)<span class="op">;</span>  <span class="co">% 赤</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span></span></code></pre></div>
<h3 id="検出力の推定">検出力の推定</h3>
<p><strong>例1 二標本<span
class="math inline">\(t\)</span>検定</strong></p>
<p>培養細胞にある遺伝子を発現させると細胞内に顆粒が形成されることがわかった。A細胞とB細胞で顆粒の直径を測定したところ、以下のデータを得た。A細胞とB細胞間において顆粒の直径に差があるといえるか。</p>
<table>
<thead>
<tr class="header">
<th>細胞</th>
<th>平均値</th>
<th>分散</th>
<th>反復数</th>
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(df\)</span></th>
<th><span class="math inline">\(p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>15.3</td>
<td>3</td>
<td>10</td>
<td>1.291</td>
<td>18</td>
<td>0.213</td>
</tr>
<tr class="even">
<td>B</td>
<td>14.3</td>
<td>3</td>
<td>10</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(p=0.213 &gt; \alpha =
0.05\)</span>であり、帰無仮説を採択する。両者に顕著な差はない。</p>
<h3
id="確率密度関数を見ながら検出力を求めよう">確率密度関数を見ながら、検出力を求めよう</h3>
<p><strong>[手順1]</strong> これは二標本<span
class="math inline">\(t\)</span>検定だから、帰無仮説(<span
class="math inline">\(H_0\)</span>)は母平均<span
class="math inline">\(\mu_A -
\mu_B=0\)</span>である。帰無仮説においては<span class="math inline">\(t
= 1.291\)</span>である。</p>
<p><strong>[手順2]</strong> 棄却域が0.05のときを有意水準 α とおく。</p>
<p><strong>[手順3]</strong> 平均0の<span
class="math inline">\(t\)</span>分布における下側と上側信頼限界を求める。</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 自由度の設定</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">df</span> <span class="op">=</span> <span class="fl">18</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">% 下側信頼限界</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="va">T1</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.025</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">T1</span>)<span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">% 上側信頼限界</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="va">T2</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.975</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">T2</span>)<span class="op">;</span></span></code></pre></div>
<p>図を見ながら棄却域の設定</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データの生成</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="va">linspace</span>(<span class="op">-</span><span class="fl">5</span><span class="op">,</span> <span class="fl">5</span><span class="op">,</span> <span class="fl">101</span>)<span class="op">;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="va">df</span> <span class="op">=</span> <span class="fl">18</span><span class="op">;</span>  <span class="co">% 自由度</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">% t分布の確率密度関数</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="va">y</span> <span class="op">=</span> <span class="va">tpdf</span>(<span class="va">x</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">% プロット</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">x</span><span class="op">,</span> <span class="va">y</span><span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;blue&#39;</span>)<span class="op">;</span>  <span class="co">% 青</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">% 縦線を引く</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="va">T1</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.025</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="va">T2</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.975</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="va">line</span>([<span class="va">T1</span> <span class="va">T1</span>]<span class="op">,</span> [<span class="fl">0</span> <span class="fl">0.40</span>]<span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;g&#39;</span><span class="op">,</span> <span class="ss">&#39;LineStyle&#39;</span><span class="op">,</span> <span class="ss">&#39;--&#39;</span>)<span class="op">;</span>  <span class="co">% 緑の点線</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="va">line</span>([<span class="va">T2</span> <span class="va">T2</span>]<span class="op">,</span> [<span class="fl">0</span> <span class="fl">0.40</span>]<span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;g&#39;</span><span class="op">,</span> <span class="ss">&#39;LineStyle&#39;</span><span class="op">,</span> <span class="ss">&#39;--&#39;</span>)<span class="op">;</span>  <span class="co">% 緑の点線</span></span></code></pre></div>
<p><strong>[手順4]</strong>
観察によって得られたt=1.291を信じて、t=1.291をセンターにもつ非心<span
class="math inline">\(t\)</span>分布は以下の図になる。</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データの生成</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="va">x</span> <span class="op">=</span> <span class="va">linspace</span>(<span class="op">-</span><span class="fl">5</span><span class="op">,</span> <span class="fl">5</span><span class="op">,</span> <span class="fl">101</span>)<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="va">df</span> <span class="op">=</span> <span class="fl">18</span><span class="op">;</span>  <span class="co">% 自由度</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="va">nc</span> <span class="op">=</span> <span class="fl">1.291</span><span class="op">;</span>  <span class="co">% 非心パラメータ</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">% t分布の確率密度関数</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="va">y</span> <span class="op">=</span> <span class="va">tpdf</span>(<span class="va">x</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">x</span><span class="op">,</span> <span class="va">y</span><span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;blue&#39;</span>)<span class="op">;</span>  <span class="co">% 青</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span>  <span class="co">% 複数のプロットを追加するため</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">% 非心t分布のPDF（オレンジ色を16進数カラーコードで指定）</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="va">y2</span> <span class="op">=</span> <span class="va">nctpdf</span>(<span class="va">x</span><span class="op">,</span> <span class="va">df</span><span class="op">,</span> <span class="va">nc</span>)<span class="op">;</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="va">plot</span>(<span class="va">x</span><span class="op">,</span> <span class="va">y2</span><span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;#FFA500&#39;</span>)<span class="op">;</span>  <span class="co">% オレンジ</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">% 縦線を引く</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="va">T1</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.025</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="va">T2</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.975</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="va">line</span>([<span class="va">T1</span> <span class="va">T1</span>]<span class="op">,</span> [<span class="fl">0</span> <span class="fl">0.40</span>]<span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;green&#39;</span><span class="op">,</span> <span class="ss">&#39;LineStyle&#39;</span><span class="op">,</span> <span class="ss">&#39;--&#39;</span>)<span class="op">;</span>  <span class="co">% 緑の点線</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="va">line</span>([<span class="va">T2</span> <span class="va">T2</span>]<span class="op">,</span> [<span class="fl">0</span> <span class="fl">0.40</span>]<span class="op">,</span> <span class="ss">&#39;Color&#39;</span><span class="op">,</span> <span class="ss">&#39;red&#39;</span><span class="op">,</span> <span class="ss">&#39;LineStyle&#39;</span><span class="op">,</span> <span class="ss">&#39;--&#39;</span>)<span class="op">;</span>  <span class="co">% 赤の点線</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">% 有意水準と検出力についての説明</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="ss">&#39;赤の点線より右側の青色のすそ野の面積が、有意水準に相当します&#39;</span>)<span class="op">;</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="ss">&#39;赤の点線より右側のオレンジ色のすそ野の面積が、検出力に相当します&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>検出力を求めます</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 上側信頼限界</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="va">df</span> <span class="op">=</span> <span class="fl">18</span><span class="op">;</span>  <span class="co">% 自由度</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="va">nc</span> <span class="op">=</span> <span class="fl">1.290994449</span><span class="op">;</span>  <span class="co">% 非心パラメータ</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="va">T2</span> <span class="op">=</span> <span class="va">tinv</span>(<span class="fl">0.975</span><span class="op">,</span> <span class="va">df</span>)<span class="op">;</span>  <span class="co">% 上側信頼限界</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 非心t分布の累積分布関数（CDF）</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="va">beta</span> <span class="op">=</span> <span class="va">nctcdf</span>(<span class="va">T2</span><span class="op">,</span> <span class="va">df</span><span class="op">,</span> <span class="va">nc</span>)<span class="op">;</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">% 検出力の計算</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="va">power</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">beta</span><span class="op">;</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">% 結果の表示</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>([<span class="ss">&#39;検出力は &#39;</span><span class="op">,</span> <span class="va">num2str</span>(<span class="va">power</span>)<span class="op">,</span> <span class="ss">&#39; です&#39;</span>])<span class="op">;</span></span></code></pre></div>
<p>検出力は70%くらいが良いといわれています。すこし低すぎますね。本当は有意差があるのに、有意差が検出されなかった、第二種の過誤(偽陰性)かもしれません。<code>num2str()</code>関数は数字を文字列型に変換し、表示させるためのもので本質的ではありません。</p>
<p>大変なので、matlabの<code>sampsizepwr</code>関数を使いましょう。等分散を仮定しています。Statistics
and Machine Learning Toolboxが必要です</p>
<p>この関数は個体数が等しいことを想定しています。個体数が異なる場合は、数字が大きいほう/数字が小さいほうを計算し、<code>Ratio</code>として与えます。</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データの定義</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="va">mu1</span> <span class="op">=</span> <span class="fl">15.3</span><span class="op">;</span>  <span class="co">% 第1集団の平均</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="va">mu2</span> <span class="op">=</span> <span class="fl">14.3</span><span class="op">;</span>  <span class="co">% 第2集団の平均</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="va">sigma</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="fl">3</span>)<span class="op">;</span>  <span class="co">% 標準偏差</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="va">n1</span> <span class="op">=</span> <span class="fl">10</span><span class="op">;</span>  <span class="co">% 第1集団のサンプルサイズ</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="va">n2</span> <span class="op">=</span> <span class="fl">10</span><span class="op">;</span>  <span class="co">% 第2集団のサンプルサイズ</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="va">ratio</span> <span class="op">=</span> <span class="va">n1</span> <span class="op">/</span> <span class="va">n2</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span>  <span class="co">% 有意水準</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 検出力の計算</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="va">power</span> <span class="op">=</span> <span class="va">sampsizepwr</span>(<span class="ss">&#39;t2&#39;</span><span class="op">,</span> [<span class="va">mu1</span> <span class="va">sigma</span>]<span class="op">,</span> <span class="va">mu2</span><span class="op">,</span> []<span class="op">,</span> <span class="va">n1</span><span class="op">,</span> <span class="ss">&#39;Alpha&#39;</span><span class="op">,</span> <span class="va">alpha</span><span class="op">,</span><span class="ss">&#39;Ratio&#39;</span><span class="op">,</span> <span class="va">ratio</span>)<span class="op">;</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="va">power</span></span></code></pre></div>
<h2 id="検出力の吟味">検出力の吟味</h2>
<p>検出力が低すぎる中で得られた結論は、特に第二種の過誤を犯している可能性が高い。検出力を70%くらいに調整する要因について探る。</p>
<h3 id="サンプルサイズの影響">サンプルサイズの影響</h3>
<p>平均値の差および分散を変えずに、反復数を増やしたとする。</p>
<p><strong>例2 二標本<span class="math inline">\(t\)</span>検定
反復数を増やした場合</strong></p>
<table>
<thead>
<tr class="header">
<th>細胞</th>
<th>平均値</th>
<th>分散</th>
<th>反復数</th>
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(df\)</span></th>
<th><span class="math inline">\(p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>15.3</td>
<td>3</td>
<td>25</td>
<td>2.041</td>
<td>48</td>
<td>0.0467</td>
</tr>
<tr class="even">
<td>B</td>
<td>14.3</td>
<td>3</td>
<td>25</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>この時、<span class="math inline">\(p=0.0467 &lt; \alpha =
0.05\)</span>であるため、帰無仮説を棄却し、対立仮説を採択する。両者に有意差があるといえる。この場合の検出力を求める。</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">%やってみて</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="va">mu1</span> <span class="op">=</span> <span class="fl">15.3</span><span class="op">;</span>  <span class="co">% 第1集団の平均</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="va">mu2</span> <span class="op">=</span> <span class="fl">14.3</span><span class="op">;</span>  <span class="co">% 第2集団の平均</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="va">sigma</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="fl">3</span>)<span class="op">;</span>  <span class="co">% 標準偏差</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="va">n1</span> <span class="op">=</span> <span class="fl">25</span><span class="op">;</span>  <span class="co">% 第1集団のサンプルサイズ</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="va">n2</span> <span class="op">=</span> <span class="fl">25</span><span class="op">;</span>  <span class="co">% 第2集団のサンプルサイズ</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="va">ratio</span> <span class="op">=</span> <span class="va">n1</span> <span class="op">/</span> <span class="va">n2</span><span class="op">;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span>  <span class="co">% 有意水準</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 検出力の計算</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="va">power</span> <span class="op">=</span> <span class="va">sampsizepwr</span>(<span class="ss">&#39;t2&#39;</span><span class="op">,</span> [<span class="va">mu1</span> <span class="va">sigma</span>]<span class="op">,</span> <span class="va">mu2</span><span class="op">,</span> []<span class="op">,</span> <span class="va">n1</span><span class="op">,</span> <span class="ss">&#39;Alpha&#39;</span><span class="op">,</span> <span class="va">alpha</span><span class="op">,</span><span class="ss">&#39;Ratio&#39;</span><span class="op">,</span> <span class="va">ratio</span>)<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="va">power</span></span></code></pre></div>
<p>検出力(<span class="math inline">\(1-\beta\)</span>)は
0.5160と推定された。最初の実験では検出力が低く、偽陰性(第二種の過誤)が起きていたと考えられる。すなわち本来は有意差があるが、実験に用いた反復数が少なすぎて有意差が検出できなかったと考えられる。今回は十分な反復数を確保した結果、検出力が向上し、有意差を正しく検出できたのであろう。</p>
<h3 id="分散の影響">分散の影響</h3>
<p>実験手法を工夫して、データのばらつき(分散)を小さくすることができた場合、</p>
<p>例4 二標本<span class="math inline">\(t\)</span>検定
分散を小さくした場合</p>
<table>
<thead>
<tr class="header">
<th>細胞</th>
<th>平均値</th>
<th>分散</th>
<th>反復数</th>
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(df\)</span></th>
<th><span class="math inline">\(p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>15.3</td>
<td>1</td>
<td>10</td>
<td>2.236</td>
<td>18</td>
<td>0.03829</td>
</tr>
<tr class="even">
<td>B</td>
<td>14.3</td>
<td>1</td>
<td>10</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>分散を小さくすると、平均値の差および反復数が同じにもかかわらず、有意になった。
検出力は、</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">% やってみて</span></span></code></pre></div>
<p>より、 0.5619846となった。分散は<span
class="math inline">\(t\)</span>分布のすそ野を狭くするため、検出力の決定に非常に重要であると考えられる。</p>
<h3 id="サンプルサイズの決定">サンプルサイズの決定</h3>
<p><img src="https://raw.githubusercontent.com/qikushu/qikushu.github.io/master/biostat/NF34LpGZMPv6.png" width="500"></p>
<p>検出力、平均値の差、反復数、分散は相互に関係しており、三者が確定すれば、残りの1者の値が求まる性質を持つ。適切な反復数を求めたい場合は、検出力、平均値の差、分散がわかればよい。検出力は0.8にすることが好ましいといわれる。二者間の平均値の差と分散のおおよその値は予備実験にてわかるとしよう。この場合、例1において検出力0.8における反復数は以下のように求める。</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="va">mypower1</span> <span class="op">=</span> <span class="fl">0.8</span><span class="op">;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="va">sampleSize</span> <span class="op">=</span> <span class="va">sampsizepwr</span>(<span class="ss">&#39;t2&#39;</span><span class="op">,</span>[<span class="va">mu1</span> <span class="va">sigma</span>]<span class="op">,</span><span class="va">mu2</span><span class="op">,</span><span class="va">mypower1</span><span class="op">,</span>[])</span></code></pre></div>
<p>となり、適切な個体数はグループあたり49個体以上である。konobaai ,
平均値の差1、分散3をもつ二者間の差を5%有意水準にて80%の確率で有意差を得ることがわかった。</p>
<h3 id="検出できる平均値の差の大きさ">検出できる平均値の差の大きさ</h3>
<p>反復数を増やせば、時間も労力もお金も消費する。なので反復数には上限がある。工夫も尽きたら、有限なリソースの中で結論を得るしかない。とすれば、検出できる平均値の差はいくらまで小さくできるのだろうか。例1において、反復は1グループあたり30個までしか増やせないとしよう。検出力0.8、分散3における最小の検出可能な平均値の差の大きさはいかにして求める。</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">% データの定義</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="va">n1</span> <span class="op">=</span> <span class="fl">30</span><span class="op">;</span>  <span class="co">% 第1集団のサンプルサイズ</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="va">n2</span> <span class="op">=</span> <span class="fl">30</span><span class="op">;</span>  <span class="co">% 第2集団のサンプルサイズ</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="va">sigma</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="fl">3</span>)<span class="op">;</span>  <span class="co">% 標準偏差</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span>  <span class="co">% 有意水準</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="va">power</span> <span class="op">=</span> <span class="fl">0.8</span><span class="op">;</span>  <span class="co">% 目指す検出力</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">% 最小の効果量の計算</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="va">effect_size</span> <span class="op">=</span> <span class="va">sampsizepwr</span>(<span class="ss">&#39;t2&#39;</span><span class="op">,</span> [<span class="fl">0</span> <span class="va">sigma</span>]<span class="op">,</span> []<span class="op">,</span> <span class="va">power</span><span class="op">,</span> <span class="va">min</span>(<span class="va">n1</span><span class="op">,</span> <span class="va">n2</span>)<span class="op">,</span> <span class="ss">&#39;Alpha&#39;</span><span class="op">,</span> <span class="va">alpha</span><span class="op">,</span> <span class="ss">&#39;Tail&#39;</span><span class="op">,</span> <span class="ss">&#39;both&#39;</span>)<span class="op">;</span></span></code></pre></div>
<p>最小の効果量は<code>1.2741</code>となった。標準偏差をかけて</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="va">effect_size</span> <span class="op">*</span> <span class="va">sigma</span></span></code></pre></div>
<p>2.2069であった。つまり今の実験条件では、2.2069の差があれば、検出力0.8にて検出できる。予備実験で差が得られたとして、いまの実験計画が適切な規模で行われているか、確認してみよう。</p>
<h3 id="高すぎる検出力">高すぎる検出力</h3>
<h4 id="例5-二標本t検定-反復数が特に多い場合">例5 二標本<span
class="math inline">\(t\)</span>検定 反復数が特に多い場合</h4>
<table>
<thead>
<tr class="header">
<th>細胞</th>
<th>平均値</th>
<th>分散</th>
<th>反復数</th>
<th><span class="math inline">\(t\)</span></th>
<th><span class="math inline">\(df\)</span></th>
<th><span class="math inline">\(p\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>15.3</td>
<td>3</td>
<td>1000</td>
<td>22.36</td>
<td>1998</td>
<td>5.01E-99</td>
</tr>
<tr class="even">
<td>B</td>
<td>14.3</td>
<td>3</td>
<td>1000</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>もちろん有意差がみられる。個体数を増やせばどんなものも有意にできるからね。このときの検出力は</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="va">mu1</span> <span class="op">=</span> <span class="fl">15.3</span><span class="op">;</span>  <span class="co">% 第1集団の平均</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="va">mu2</span> <span class="op">=</span> <span class="fl">14.3</span><span class="op">;</span>  <span class="co">% 第2集団の平均</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="va">sigma</span> <span class="op">=</span> <span class="va">sqrt</span>(<span class="fl">3</span>)<span class="op">;</span>  <span class="co">% 標準偏差</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="va">n1</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">;</span>  <span class="co">% 第1集団のサンプルサイズ</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="va">n2</span> <span class="op">=</span> <span class="fl">1000</span><span class="op">;</span>  <span class="co">% 第2集団のサンプルサイズ</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="va">ratio</span> <span class="op">=</span> <span class="va">n1</span> <span class="op">/</span> <span class="va">n2</span><span class="op">;</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="va">alpha</span> <span class="op">=</span> <span class="fl">0.05</span><span class="op">;</span>  <span class="co">% 有意水準</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="co">% 検出力の計算</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="va">power</span> <span class="op">=</span> <span class="va">sampsizepwr</span>(<span class="ss">&#39;t2&#39;</span><span class="op">,</span> [<span class="va">mu1</span> <span class="va">sigma</span>]<span class="op">,</span> <span class="va">mu2</span><span class="op">,</span> []<span class="op">,</span> <span class="va">n1</span><span class="op">,</span> <span class="ss">&#39;Alpha&#39;</span><span class="op">,</span> <span class="va">alpha</span><span class="op">,</span><span class="ss">&#39;Ratio&#39;</span><span class="op">,</span> <span class="va">ratio</span>)<span class="op">;</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="va">power</span></span></code></pre></div>
<p>power=1となった。たとえ環境の影響を受けたノイズであっても、第一種の過誤による有意差が検出されてしまう状況である。適切な規模で計算をやり直す必要がある。本来有意差がないにも関わらず、偽陽性で有意差がでる状況は好ましくない。</p>
<h2 id="実験計画法">実験計画法</h2>
<p>実験を行う前に、多数の要因が想定されるが、実験前には重要な要因はわからないとする。例えば、卵の寄生蜂に関する実験のため、卵を大量に準備したいとする。蔵卵数に関与する要因として、温度、人工飼料の種類、ストレス処理、羽化後の日数など多数の要因について検証することを考えよう。
この場合、</p>
<ol type="1">
<li>実験1: 温度 (20度と25度 : 2水準)</li>
<li>実験2: 人工飼料 (A飼料とB飼料: 2水準)</li>
<li>実験3: ストレス処理 (刺激と無刺激: 2水準)</li>
<li>実験4: 羽化後の日数 (5-10日と11-15日: 2水準)</li>
</ol>
<p>のように、各要因それぞれについて実験を行うであろう。しかし、温度条件によって人工飼料の摂食行動が変化する、などの温度条件と人工飼料の種類に交互作用がある場合等、蔵卵数を最大化する「最適な条件の組み合わせ」について検討を行いたい場合は、温度
x 人工飼料 x 生育シャーレ x 羽化後の日数 = 2 x 2 x 2 x 2 =16
実験区のように、各要因を組み合わせた実験区を設定する必要がある。5要因について3水準ずつを予定した場合は<span
class="math inline">\(3^5=243\)</span>通りの実験が考えられる。
「熱工学がエネルギーの効率的利用の科学とすれば、実験計画法は情報量の効率的利用の科学である(田口玄一)」とあるように、実験計画法は統計学的な背景のもと、(1)実験における偏りをできるだけ排除すること、(2)効率の良い実験を行うこと、この主に2点について理論的な基盤を与える。</p>
<p><strong>実験計画法では、実験時に生じる時間や空間、実験者、機械等の「排除できない偏り」を「実験後に」できるだけ補正できるよう「実験前に」計画しておき、良い結果に近づこうとする</strong></p>
<h3 id="つり合い型計画-balanced-design">つり合い型計画 (balanced
design)</h3>
<p>複数の要因について考慮する場合は、各要因の実験条件(水準という)が均等に交差するように配置する(図)。</p>
<p><img src="https://raw.githubusercontent.com/qikushu/qikushu.github.io/master/biostat/random_design.png" width="800"></p>
<p>図Aでは施肥と品種の水準の配置パターンが一致しているため、施肥と品種の間に真の相関がなくてもと施肥と品種の間には相関が生まれる。これは実験計画上のミスで、<strong>交絡(confound)</strong>という。
施肥と品種の水準をランダムに無限数配置した場合、交絡は0に近づくが実験区が少ない場合は、実験区の数に偏りが出てうまく消去できない(図B)。そこで、二要因のすべての水準の組み合わせについて、数をそろえて実験を行う。これを<strong>つり合い(balanced)</strong>型という。</p>
<h3 id="乱塊法">乱塊法</h3>
<p>つり合い型計画にて実験区を設定したとしても、農学実験では実験を均一の条件でできず、人間が制御できない偏りがある。例えば図Aは実験の計測の日程表である。</p>
<p><img src="https://raw.githubusercontent.com/qikushu/qikushu.github.io/master/biostat/block_design1.png" width="500">
<strong>図. 乱塊法の例2</strong></p>
<p>実験区は1要因A、B、Cの三水準があり、各実験区に3反復の
計9回の実験を予定している。一日に4実験区しか処理できない場合、素直に表の頭から順番に4実験区をこなしていこうとすると、日によって機械の調子に違いがある場合、機械の調子の偏りが実験区の偏りとして現れる。
これを系統誤差という。これを実験誤差に転化するには、ブロック内で実験条件が均一化するように、実験区を配置する)。これを<strong>乱塊法(randomized
block design)</strong>という。
ブロック内で実験条件ができるだけ均一化することを<strong>局所管理</strong>という。</p>
<p>時間的な系統誤差が生まれる場合について説明したが、空間的な系統誤差については次の図を見てもらいたい</p>
<p><img src="https://raw.githubusercontent.com/qikushu/qikushu.github.io/master/biostat/block_design2.png" width="500"></p>
<p><strong>図. 乱塊法の例2</strong></p>
<p>圃場にて3x3の9条件にて実験を行うとする、圃場には大きく日照条件の傾向がある(図)。圃場全体の日照条件を完全に均一にすることはできないが、圃場を例えば三つのブロックに分割し、そのブロック内では比較的日照条件が均一であると仮定し、統計的に消去する。さらにブロック内では各実験区をランダムに配置することにより、南北の系統誤差を偶然誤差に転化し、系統誤差を消去する。</p>
<p>ブロック化として想定されるものとしては、操作者の手作業の偏り、インキュベーター内にも温度の偏り、ロット間でぶれの大きい培養液なども考えらえる。</p>
<h3 id="実験後の解析">実験後の解析</h3>
<p>乱塊法は適切な統計手法と組み合わせて解析しなければ、当初の目的は果たせない。分散分析では、観測データ全体の分散からブロックの分散として分割して消去(補正)する。多重回帰では主要因にブロックの要因を含めてブロックの偏回帰係数を推定し、消去(補正)する。</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="va">url</span><span class="op">=</span><span class="st">&quot;https://raw.githubusercontent.com/yoshi0601/stat/master/doe_block2.txt&quot;</span><span class="op">;</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="va">t1</span> <span class="op">=</span> <span class="va">readtable</span>(<span class="va">url</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="va">t1</span>.<span class="va">Variety</span> <span class="op">=</span> <span class="va">categorical</span>(<span class="va">t1</span>.<span class="va">Variety</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="va">t1</span>.<span class="va">Block</span> <span class="op">=</span> <span class="va">categorical</span>(<span class="va">t1</span>.<span class="va">Block</span>)</span></code></pre></div>
<p>散布図を作成する。<code>gscatter()</code>関数により、x軸とy軸に設定したデータに基づき、散布図を作成してくれるが、カテゴリ別にさらに色分けして分類してほしい場合はこの関数を用いる。</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="va">gscatter</span>(<span class="va">t1</span>.<span class="va">Variety</span><span class="op">,</span> <span class="va">t1</span>.<span class="va">Yield</span><span class="op">,</span> <span class="va">t1</span>.<span class="va">Block</span>)<span class="op">;</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">&#39;Variety&#39;</span>)<span class="op">;</span>  <span class="co">% x軸のラベル</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">&#39;Yield&#39;</span>)<span class="op">;</span>  <span class="co">% y軸のラベル</span></span></code></pre></div>
<p>気づきとしては、ブロックAのほうが収量が低い。品種の平均値がすべて等しいかと言われれば、そうでもないので、分散分析により確かめよう。</p>
<p>ブロックを考慮しない分散分析</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 最小二乗法による線形モデルのフィット</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">t1</span><span class="op">,</span> <span class="ss">&#39;Yield~Variety&#39;</span>)<span class="op">;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">% ANOVAテーブルの作成</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="va">anovaTable</span> <span class="op">=</span> <span class="va">anova</span>(<span class="va">lm</span>)<span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">anovaTable</span>)<span class="op">;</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">%以下は結果</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>               <span class="va">SumSq</span>     <span class="va">DF</span>    <span class="va">MeanSq</span>      <span class="va">F</span>       <span class="va">pValue</span> </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>               ______    __    ______    _____    ________</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">Variety</span>    <span class="fl">3960.1</span>     <span class="fl">3</span>      <span class="fl">1320</span>    <span class="fl">2.336</span>    <span class="fl">0.095245</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">Error</span>       <span class="fl">15822</span>    <span class="fl">28</span>    <span class="fl">565.07</span></span></code></pre></div>
<p>この結果を見ると、<code>Yield</code>は<code>Variety</code>間に差がないとの結果になった。私たちが目視で確認すると、<code>block</code>別に見ると、<code>Yield</code>は<code>Variety</code>間に差があるように見える。そこで、<code>block</code>を因子に組み込んだ(分類した)うえで、改めて分散分析を行ってみよう。</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 最小二乗法による線形モデルのフィット</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">t1</span><span class="op">,</span> <span class="ss">&#39;Yield~Variety + Block&#39;</span>)<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co">% ANOVAテーブルの作成</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="va">anovaTable</span> <span class="op">=</span> <span class="va">anova</span>(<span class="va">lm</span>)<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">anovaTable</span>)<span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">%以下は結果</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>               <span class="va">SumSq</span>     <span class="va">DF</span>    <span class="va">MeanSq</span>      <span class="va">F</span>         <span class="va">pValue</span>  </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>               ______    __    ______    ______    __________</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">Variety</span>    <span class="fl">3960.1</span>     <span class="fl">3</span>      <span class="fl">1320</span>    <span class="fl">6.4116</span>     <span class="fl">0.0020183</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">Block</span>       <span class="fl">10263</span>     <span class="fl">1</span>     <span class="fl">10263</span>     <span class="fl">49.85</span>    <span class="fl">1.3666e-07</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">Error</span>      <span class="fl">5558.7</span>    <span class="fl">27</span>    <span class="fl">205.88</span>     </span></code></pre></div>
<p>Blockの効果をモデルに投入することで、Blockによる効果で補正した残差に対してVarietyの効果を検討していることになる。この場合、Varietyにより収量が異なることが示されている。</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">% より詳細な確認 線形モデルの結果を確認する</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">% いかが結果</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="va">Linear</span> <span class="va">regression</span> <span class="va">model</span><span class="op">:</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">Yield</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Variety</span> <span class="op">+</span> <span class="va">Block</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="va">Estimated</span> <span class="va">Coefficients</span><span class="op">:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>                   <span class="va">Estimate</span>      <span class="va">SE</span>       <span class="va">tStat</span>       <span class="va">pValue</span>  </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>                   ________    ______    _______    __________</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    (<span class="va">Intercept</span>)     <span class="fl">300.81</span>     <span class="fl">5.6717</span>     <span class="fl">53.037</span>    <span class="fl">7.7275e-29</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">Variety_B</span>      <span class="op">-</span><span class="fl">9.4571</span>     <span class="fl">7.1742</span>    <span class="op">-</span><span class="fl">1.3182</span>       <span class="fl">0.19851</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">Variety_C</span>       <span class="fl">16.102</span>     <span class="fl">7.1742</span>     <span class="fl">2.2444</span>      <span class="fl">0.033207</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">Variety_D</span>       <span class="fl">16.868</span>     <span class="fl">7.1742</span>     <span class="fl">2.3511</span>      <span class="fl">0.026269</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="va">Block_B</span>         <span class="fl">35.817</span>      <span class="fl">5.073</span>     <span class="fl">7.0605</span>    <span class="fl">1.3666e-07</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="va">Number</span> <span class="va">of</span> <span class="va">observations</span><span class="op">:</span> <span class="fl">32</span><span class="op">,</span> <span class="va">Error</span> <span class="va">degrees</span> <span class="va">of</span> <span class="va">freedom</span><span class="op">:</span> <span class="fl">27</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="va">Root</span> <span class="va">Mean</span> <span class="va">Squared</span> <span class="va">Error</span><span class="op">:</span> <span class="fl">14.3</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="va">R</span><span class="op">-</span><span class="va">squared</span><span class="op">:</span> <span class="fl">0.719</span><span class="op">,</span>  <span class="va">Adjusted</span> <span class="va">R</span><span class="op">-</span><span class="va">Squared</span><span class="op">:</span> <span class="fl">0.677</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="va">F</span><span class="op">-</span><span class="va">statistic</span> <span class="va">vs</span>. <span class="va">constant</span> <span class="va">model</span><span class="op">:</span> <span class="fl">17.3</span><span class="op">,</span> <span class="va">p</span><span class="op">-</span><span class="va">value</span> <span class="op">=</span> <span class="fl">3.87e-07</span></span></code></pre></div>
<p>BlockのEstimateが35.8175ある。Block Aを基準として Block
Bに35.8175足してから一元配置の分散分析をした、という感覚である。全体の誤差を最小化するように、すべての変数を同時にいい感じに推定するので、順番はない。</p>
<h2 id="重回帰-multiple-regressionにおけるブロックの活用">重回帰
(multiple regression)におけるブロックの活用</h2>
<p>前節は独立変数がカテゴリカル(因子型)データで水準で表される場合であった。その場合は分散分析を用いた。本節は独立変数が量的データの場合である。この場合は重回帰と呼ばれる方法になる。</p>
<pre><code>%データ読み込み
t2 = readtable(&quot;https://raw.githubusercontent.com/yoshi0601/stat/master/doe_block_lm.txt&quot;)
t2.Block = categorical(t2.Block)

% まずはBlockを考慮しない散布図を作ろう
gscatter(t2.Fert, t2.Yield);
xlabel(&#39;Variety&#39;);  % x軸のラベル
ylabel(&#39;Yield&#39;);  % y軸のラベル</code></pre>
<p>右肩上がりかな。右肩下がりかな</p>
<p>ブロックを考慮しない回帰分析</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 最小二乗法による線形モデルのフィット</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm2</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">t2</span><span class="op">,</span> <span class="ss">&#39;Yield~Fert&#39;</span>)<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">lm2</span>)<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">% 以下が結果</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="va">Linear</span> <span class="va">regression</span> <span class="va">model</span><span class="op">:</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">Yield</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Fert</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="va">Estimated</span> <span class="va">Coefficients</span><span class="op">:</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                   <span class="va">Estimate</span>      <span class="va">SE</span>       <span class="va">tStat</span>       <span class="va">pValue</span>  </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>                   ________    _______    ______    __________</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    (<span class="va">Intercept</span>)     <span class="fl">287.91</span>      <span class="fl">17.125</span>    <span class="fl">16.812</span>    <span class="fl">8.1503e-17</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="va">Fert</span>            <span class="fl">2.1211</span>     <span class="fl">0.95968</span>    <span class="fl">2.2103</span>      <span class="fl">0.034857</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="va">Number</span> <span class="va">of</span> <span class="va">observations</span><span class="op">:</span> <span class="fl">32</span><span class="op">,</span> <span class="va">Error</span> <span class="va">degrees</span> <span class="va">of</span> <span class="va">freedom</span><span class="op">:</span> <span class="fl">30</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a><span class="va">Root</span> <span class="va">Mean</span> <span class="va">Squared</span> <span class="va">Error</span><span class="op">:</span> <span class="fl">23.8</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="va">R</span><span class="op">-</span><span class="va">squared</span><span class="op">:</span> <span class="fl">0.14</span><span class="op">,</span>  <span class="va">Adjusted</span> <span class="va">R</span><span class="op">-</span><span class="va">Squared</span><span class="op">:</span> <span class="fl">0.111</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="va">F</span><span class="op">-</span><span class="va">statistic</span> <span class="va">vs</span>. <span class="va">constant</span> <span class="va">model</span><span class="op">:</span> <span class="fl">4.89</span><span class="op">,</span> <span class="va">p</span><span class="op">-</span><span class="va">value</span> <span class="op">=</span> <span class="fl">0.0349</span></span></code></pre></div>
<p>回帰直線の係数はEstimateに記載されている。肥料(Fert)が1単位増加すると、収量が2.1211増加すると予測されている。この係数の帰無仮説は0である。coefをt値に変換した値がt列であり、2.21である。このp値は0.034857であり、有意水準5%より小さいので有意となった。</p>
<p>今回はギリギリ有意水準以下になったが、通常ブロック化を考慮しない場合、有意にならない場合もあるので、ブロックを考慮した方が良い。</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Blockを考慮する散布図を作ろう</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="va">gscatter</span>(<span class="va">t2</span>.<span class="va">Fert</span><span class="op">,</span> <span class="va">t2</span>.<span class="va">Yield</span><span class="op">,</span> <span class="va">t2</span>.<span class="va">Block</span>)<span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">&#39;Variety&#39;</span>)<span class="op">;</span>  <span class="co">% x軸のラベル</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">&#39;Yield&#39;</span>)<span class="op">;</span>  <span class="co">% y軸のラベル</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">% 最小二乗法による線形モデルのフィット</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="va">lm2b</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">t2</span><span class="op">,</span> <span class="ss">&#39;Yield ~ Fert+ Block&#39;</span>)<span class="op">;</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">lm2b</span>)<span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">% 以下が結果</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="va">Linear</span> <span class="va">regression</span> <span class="va">model</span><span class="op">:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">Yield</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Fert</span> <span class="op">+</span> <span class="va">Block</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="va">Estimated</span> <span class="va">Coefficients</span><span class="op">:</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                   <span class="va">Estimate</span>      <span class="va">SE</span>       <span class="va">tStat</span>       <span class="va">pValue</span>  </span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>                   ________    _______    ______    __________</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    (<span class="va">Intercept</span>)     <span class="fl">272.07</span>      <span class="fl">11.458</span>    <span class="fl">23.745</span>    <span class="fl">1.4943e-20</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="va">Fert</span>            <span class="fl">2.0149</span>     <span class="fl">0.62727</span>    <span class="fl">3.2122</span>     <span class="fl">0.0032166</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>    <span class="va">Block_B</span>         <span class="fl">35.352</span>       <span class="fl">5.503</span>     <span class="fl">6.424</span>    <span class="fl">5.0115e-07</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="va">Number</span> <span class="va">of</span> <span class="va">observations</span><span class="op">:</span> <span class="fl">32</span><span class="op">,</span> <span class="va">Error</span> <span class="va">degrees</span> <span class="va">of</span> <span class="va">freedom</span><span class="op">:</span> <span class="fl">29</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="va">Root</span> <span class="va">Mean</span> <span class="va">Squared</span> <span class="va">Error</span><span class="op">:</span> <span class="fl">15.6</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="va">R</span><span class="op">-</span><span class="va">squared</span><span class="op">:</span> <span class="fl">0.645</span><span class="op">,</span>  <span class="va">Adjusted</span> <span class="va">R</span><span class="op">-</span><span class="va">Squared</span><span class="op">:</span> <span class="fl">0.621</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a><span class="va">F</span><span class="op">-</span><span class="va">statistic</span> <span class="va">vs</span>. <span class="va">constant</span> <span class="va">model</span><span class="op">:</span> <span class="fl">26.4</span><span class="op">,</span> <span class="va">p</span><span class="op">-</span><span class="va">value</span> <span class="op">=</span> <span class="fl">3e-07</span></span></code></pre></div>
<p>モデル式が<code>Yield ~ 1 + Fert + Block</code>と表示されているか、確認しよう。1は切片を含めるモデルという意味なので心配いらない。</p>
<p>係数EstimateにはBlockとFertの二つが表示されている。BlockがAからBに変化すると、収量は35.352増加すると推定された。そのブロックの効果にて補正しつつ、回帰分析を行うと、肥料(Fert)が一単位上昇すると、収量が2.0149増加すると推定されている。t値を見ると、0.003であり、先ほどのp値より一桁小さい値になっている。</p>
<p>すなわちブロックを考慮しないばあい、ブロックの違いはノイズとして統計モデルに認識され、その影響がt値の小ささとしてでてきて、p値が大きくなる。一方、ブロックを考慮した場合ブロックの違いは推定に組み込まれ、残差誤差が小さくなるので、t値が大きく、かつp値が小さくなる。</p>
<h3 id="ダミー変数">ダミー変数</h3>
<p><code>Block01</code>列はダミー変数といい、カテゴリカル型データ(因子型)の水準を0と1で表現するものである。内部的にはA,Bなどのクラス分けは0と1に分類される。</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">% Blockの代わりに、Block01で解いてみる。</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="va">lm2b01</span> <span class="op">=</span> <span class="va">fitlm</span>(<span class="va">t2</span><span class="op">,</span> <span class="ss">&#39;Yield ~ Fert+ Block01&#39;</span>)<span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="va">disp</span>(<span class="va">lm2b01</span>)<span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">% 以下が結果</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="va">Linear</span> <span class="va">regression</span> <span class="va">model</span><span class="op">:</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">Yield</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">Fert</span> <span class="op">+</span> <span class="va">Block01</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="va">Estimated</span> <span class="va">Coefficients</span><span class="op">:</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>                   <span class="va">Estimate</span>      <span class="va">SE</span>       <span class="va">tStat</span>       <span class="va">pValue</span>  </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>                   ________    _______    ______    __________</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    (<span class="va">Intercept</span>)     <span class="fl">272.07</span>      <span class="fl">11.458</span>    <span class="fl">23.745</span>    <span class="fl">1.4943e-20</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    <span class="va">Fert</span>            <span class="fl">2.0149</span>     <span class="fl">0.62727</span>    <span class="fl">3.2122</span>     <span class="fl">0.0032166</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">Block01</span>         <span class="fl">35.352</span>       <span class="fl">5.503</span>     <span class="fl">6.424</span>    <span class="fl">5.0115e-07</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="va">Number</span> <span class="va">of</span> <span class="va">observations</span><span class="op">:</span> <span class="fl">32</span><span class="op">,</span> <span class="va">Error</span> <span class="va">degrees</span> <span class="va">of</span> <span class="va">freedom</span><span class="op">:</span> <span class="fl">29</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a><span class="va">Root</span> <span class="va">Mean</span> <span class="va">Squared</span> <span class="va">Error</span><span class="op">:</span> <span class="fl">15.6</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="va">R</span><span class="op">-</span><span class="va">squared</span><span class="op">:</span> <span class="fl">0.645</span><span class="op">,</span>  <span class="va">Adjusted</span> <span class="va">R</span><span class="op">-</span><span class="va">Squared</span><span class="op">:</span> <span class="fl">0.621</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="va">F</span><span class="op">-</span><span class="va">statistic</span> <span class="va">vs</span>. <span class="va">constant</span> <span class="va">model</span><span class="op">:</span> <span class="fl">26.4</span><span class="op">,</span> <span class="va">p</span><span class="op">-</span><span class="va">value</span> <span class="op">=</span> <span class="fl">3e-07</span></span></code></pre></div>
<p>全く同じ結果である。これはカテゴリデータは内部的にダミー変数(0と1)に翻訳して、重回帰解析をしているためである。線形モデル(linear
model)といい、分散分析と重回帰は線形モデルのもと統合され、同一の線形代数の数式により解くことができる。</p>
<h4 id="重回帰がしていること">重回帰がしていること</h4>
<p>ダミー変数を使えば、分散分析も重回帰も同様の手法で解ける。なので重回帰のイメージをつかんでおくことが重要でしょう。今回は<code>Fert</code>、<code>Yield</code>,
<code>Block01</code>の三変数からなる三次元空間を頭の中に用意しよう。</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode matlab"><code class="sourceCode matlab"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">% 三次元散布図の描画</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="va">scatter3</span>(<span class="va">t2</span>.<span class="va">Fert</span><span class="op">,</span> <span class="va">t2</span>.<span class="va">Block01</span><span class="op">,</span> <span class="va">t2</span>.<span class="va">Yield</span><span class="op">,</span> <span class="ss">&#39;filled&#39;</span>)<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">on</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">% フィット面の描画</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>[<span class="va">FertGrid</span><span class="op">,</span> <span class="va">Block01Grid</span>] <span class="op">=</span> <span class="va">meshgrid</span>(<span class="va">min</span>(<span class="va">t2</span>.<span class="va">Fert</span>)<span class="op">:</span><span class="fl">1</span><span class="op">:</span><span class="va">max</span>(<span class="va">t2</span>.<span class="va">Fert</span>)<span class="op">,</span> <span class="va">min</span>(<span class="va">t2</span>.<span class="va">Block01</span>)<span class="op">:</span><span class="fl">1</span><span class="op">:</span><span class="va">max</span>(<span class="va">t2</span>.<span class="va">Block01</span>))<span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="va">YieldFit</span> <span class="op">=</span> <span class="va">feval</span>(<span class="va">lm2b01</span><span class="op">,</span> <span class="va">table</span>(<span class="va">FertGrid</span>(<span class="op">:</span>)<span class="op">,</span> <span class="va">Block01Grid</span>(<span class="op">:</span>)<span class="op">,</span> <span class="ss">&#39;VariableNames&#39;</span><span class="op">,</span> {<span class="ss">&#39;Fert&#39;</span><span class="op">,</span> <span class="ss">&#39;Block01&#39;</span>}))<span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="va">mesh</span>(<span class="va">FertGrid</span><span class="op">,</span> <span class="va">Block01Grid</span><span class="op">,</span> <span class="va">reshape</span>(<span class="va">YieldFit</span><span class="op">,</span> <span class="va">size</span>(<span class="va">FertGrid</span>)))<span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co">% ラベルとタイトルの追加</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a><span class="va">xlabel</span>(<span class="ss">&#39;Fert&#39;</span>)<span class="op">;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="va">ylabel</span>(<span class="ss">&#39;Block01&#39;</span>)<span class="op">;</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="va">zlabel</span>(<span class="ss">&#39;Yield&#39;</span>)<span class="op">;</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="va">title</span>(<span class="ss">&#39;3D Scatter Plot with Regression Plane&#39;</span>)<span class="op">;</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="va">hold</span> <span class="va">off</span><span class="op">;</span></span></code></pre></div>
<p>矢印キーでいろいろ回転させてみよう。今回は3変数の重回帰を行った。
<code>Yield</code>に対して、平面で回帰している様子がわかると思う</p>
<h4
id="より一般化したn変数の重回帰について">より一般化したn変数の重回帰について</h4>
<p>一般化して、変数が<span
class="math inline">\(n\)</span>個の場合は<span
class="math inline">\(n\)</span>次元空間を考える。この場合は従属変数<span
class="math inline">\(y\)</span>以外の<span
class="math inline">\(n-1\)</span>変数からなる超平面にて回帰する。</p>
<p><span class="math inline">\(i\)</span>番目の個体の<span
class="math inline">\(y_i\)</span>を、n-1個の独立変数<span
class="math inline">\(x_{1,i}, x_{2,i}, \cdots,
x_{n-1,i}\)</span>からなる回帰式 <span class="math display">\[
\hat{Yield_i} = a_1 x_{1,i} + a_2 x_{2,i} + \cdots+ a_{n-1} x_{n-1,i} +
a_n
\]</span> にて回帰できると仮定する(<span
class="math inline">\(a\)</span>の記号に<span
class="math inline">\(i\)</span>の添え字がつかないのは、個体にかかわらず同じ値だからです)。<span
class="math inline">\(Yield\)</span>は観察値なので<code>Yield</code>軸に対しては自由に動けますが、<span
class="math inline">\(\hat{Yield}\)</span>の値はこの方程式に縛られるので、
回帰(超)平面は、<code>Yield</code>軸に対しては平面になります。</p>
<p><span class="math display">\[
\sum_{i=1}^n { (Yield - \hat{Yield})^2}
\]</span> を最小化する<span class="math inline">\(a_1, \cdots,
a_n\)</span>の組を最小二乗推定値とします。</p>
<h3 id="直交表">直交表</h3>
<p>やらない</p>
<p>今年成人になられるみなさんおめでとうございます!
これからも学業、スポーツ、大学生活頑張ってください</p>
            </div>
    </div>
  </div>
  <script src="https://vjs.zencdn.net/5.4.4/video.js"></script>

</body>
</html>
